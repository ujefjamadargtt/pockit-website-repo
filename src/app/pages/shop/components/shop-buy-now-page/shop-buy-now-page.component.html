<div
  *ngIf="loadService"
  class="container my-4 flex-center-50vw"
>
  <div *ngIf="loadService" class="spinner-border text-secondary" role="status">
    <span class="sr-only"></span>
  </div>
</div>
<div
  *ngIf="!loadService"
  class="container my-4 pt-20-br-4"
>
  <div
    class="row g-4 bg-white rounded-4 shadow unique-box"
  >
    <div class="col-12 col-lg-8 col-md-12">
      <div class="row">
        <div class="col-12 col-lg-6 col-md-12">
          <section
            id="hero"
            class="hero section dark-background imageHeight bg-white"
          >
            <div
              [ngStyle]="{
                                'background-position': 'center',
                                'background-size': '100% 100%',
                                'background-repeat': 'no-repeat',
                                 'background-image': 'url('+selectedImage+')',}"
              class="carousel hero-carousel-container height-243px"
            ></div>
          </section>
          <div class="d-flex padding-vertical-10">
            <div
              class="thumb me-2"
              *ngFor="let item of inventoryImageMappingdata"
            >
              <img
                [src]="IMAGEuRL + 'InventoryImages/' + item.IMAGE_URL"
                alt="{{ item.IMAGE_URL }}"
                class="carousel-image full-size-clickable"
                (click)="selectImage(item.IMAGE_URL)"
              />
            </div>
          </div>
        </div>
        <div
          *ngFor="let data of inventorydata"
          class="col-12 col-lg-6 col-md-12"
        >
          <h4
            class="fw-bold text-style-15-500"
          >
            {{ data.VARIANT_NAME }}
          </h4>
          <div>
            <p
              *ngIf="data.UNIT_STOCK != 0"
              class="text-style-13-500-gray"
            >
              {{ data.UNIT_STOCK }} {{ "shop.leftInStock" | translate }}
            </p>
            <p
              *ngIf="data.UNIT_STOCK == 0"
              class="text-13-500-gray-red"
            >
              {{ data.UNIT_STOCK }} {{ "shop.leftInStock" | translate }}
            </p>
          </div>
          <hr class="mt-10" />
          <div>
            <h3
              *ngIf="data.DISCOUNT_ALLOWED == 1"
              class="text-14-600-blue"
            >
              ₹ {{ data.DISCOUNTED_PRICE | number }} &nbsp;&nbsp;
              <span
                class="text-muted text-decoration-line-through text-14-600"
              >
                ₹{{ data.SELLING_PRICE | number }}</span
              >
            </h3>
            <h3
              *ngIf="data.DISCOUNT_ALLOWED == 0"
              class="text-14-600-blue"
            >
              ₹ {{ data.SELLING_PRICE | number }} &nbsp;&nbsp;
            </h3>
            <p class="text-11-400-gray"
            >
              ({{ "shop.Inclusive" | translate }})
            </p>
          </div>
          <hr />
          <div
            class="d-flex justify-content-between align-items-center border p-3 rounded text-center mb-3"
          >
            <div
              *ngIf="data.WARRANTY_ALLOWED == 1"
              class="d-flex flex-column align-items-center text-center gap-2"
            >
              <div
                class="icon rounded-circle overflow-hidden box-50px"
              >
                <img
                  src="assets/img/warranty.svg"
                  alt="Warranty Image"
                  class="img-fluid rounded-circle w-100 h-100 size-25px"
                />
              </div>
              <p
                *ngIf="data.WARRANTY_PERIOD != 0"
                class="mb-0 text-10-black"
              >
                {{ formatPeriodCommon(data.WARRANTY_PERIOD) }} warranty
              </p>
              <p
                *ngIf="data.WARRANTY_PERIOD == 0"
                class="mb-0 text-10-black"
              >
                {{ "shop.Nowarrantyavailable" | translate }}
              </p>
            </div>
            <div
              *ngIf="data.GUARANTEE_ALLOWED == 1"
              class="d-flex flex-column align-items-center text-center gap-2"
            >
              <div
                class="icon rounded-circle overflow-hidden box-50px"
              >
                <img
                  src="assets/img/safe.png"
                  alt="Safe Image"
                  class="img-fluid rounded-circle w-100 h-100 size-25px"
                />
              </div>
              <p
                *ngIf="data.GUARANTEE_PERIOD != 0"
                class="mb-0 text-10-black"
              >
                {{ formatPeriodCommon(data.GUARANTEE_PERIOD) }} Guarantee
              </p>
              <p
                *ngIf="data.GUARANTEE_PERIOD == 0"
                class="mb-0 text-10-black"
              >
                {{ "shop.NoGuaranteeavailable" | translate }}
              </p>
            </div>
            <div
              class="d-flex flex-column align-items-center text-center gap-2"
            >
              <div
                class="icon rounded-circle overflow-hidden box-50px"
              >
                <img
                  src="assets/img/delivery.svg"
                  alt="Delivery Image"
                  class="img-fluid rounded-circle w-100 h-100 size-25px"
                />
              </div>
              <p
                *ngIf="data.EXPECTED_DELIVERY_IN_DAYS != 0"
                class="mb-0 text-10-black"
              >
                {{ "shop.ExpectedDelivery" | translate }}
                {{ formatPeriodCommon(data.EXPECTED_DELIVERY_IN_DAYS) }}
              </p>
              <p
                *ngIf="data.EXPECTED_DELIVERY_IN_DAYS == 0"
                class="mb-0 text-10-black"
              >
                {{ "shop.ExpectedDeliveryNotAvailable" | translate }}
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div
          class="col-12 col-md-12 pt-20"
          *ngIf="
            inventorydata !== undefined &&
            inventorydata[0]['INVENTORY_DETAILS_IMAGE']
          "
        >
          <img
            [src]="
              IMAGEurl +
              'InventoryDetailsImage/' +
              inventorydata[0]['INVENTORY_DETAILS_IMAGE']
            "
            class="img-fluid full-width-rounded"
            alt="{{ inventorydata[0]['INVENTORY_DETAILS_IMAGE'] }}"
            (error)="handleImageError($event)"
          />
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-4 col-md-12">
      <div
        *ngFor="let data of inventorydata"
        class="border p-3 rounded p-10"
      >
        <h5
          class="fw-bold text-15-500"
        >
          {{ "shop.Description" | translate }}
        </h5>
        <hr class="my-5-8" />
        <div>
          <p
            [innerHTML]="gethtmlconent(data.DESCRIPTION)" class="scrollable-max-280"
          ></p>
        </div>
        <hr />
        <div
          class="container mt-3 mb-3 my-19-25 "
        >
          <div class="quantity-container">
            <label
              class="me-2 fw-bold text-14-500"
              >{{ "shop.Quantity" | translate }}</label
            >&nbsp;
            <button
              class="quantity-btn rounded-border-16"
              [disabled]="
                teritory_id === 0 ||
                teritory_id === null ||
                teritory_id === undefined
              "
              (click)="decreaseQuantity()"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="15"
                height="6"
                viewBox="0 0 22 6"
                fill="none"
              >
                <path
                  d="M21.1818 0.5V5.5H0.818115V0.5H21.1818Z"
                  fill="#CBCBCB"
                />
              </svg>
            </button>
            <input
              type="text"
              class="quantity-input text-20-500-gray"
              [(ngModel)]="quantity"
              readonly
            />
            <button
              class="quantity-btn rounded-border-16"
              [disabled]="
                teritory_id === 0 ||
                teritory_id === null ||
                teritory_id === undefined
              "
              (click)="increaseQuantity(data)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="15"
                height="15"
                viewBox="0 0 24 24"
                fill="none"
              >
                <path
                  d="M10.0909 23.25V0.75H13.9091V23.25H10.0909ZM0.75 13.9091V10.0909H23.25V13.9091H0.75Z"
                  fill="#0E0E0E"
                />
              </svg>
            </button>
          </div>
        </div>
        <button
          *ngIf="data.IS_ALREADY_IN_CART == 1"
          [disabled]="data.UNIT_STOCK == 0"
          class="btn w-100 mb-2 text-14-3170de"
          routerLink="/shop/cart"
        >
          {{ "shop.gotocart" | translate }}
        </button>
        <button
          *ngIf="data.IS_ALREADY_IN_CART == 0"
          [disabled]="data.UNIT_STOCK == 0"
          class="btn w-100 mb-2 equal-height text-14-3170de"
          (click)="
            teritory_id !== 0 &&
            teritory_id !== null &&
            teritory_id !== undefined
              ? addToCart(data)
              : openSuggestionModal()
          "
        >
          {{ "shop.AddToCart" | translate }}
          <span
            *ngIf="loadingStatesforcart[data.ID]"
            class="spinner-border spinner-border-sm me-2"
          ></span>
        </button>
        <button
          [disabled]="data.UNIT_STOCK == 0"
          class="w-100 equal-height btn-3170de"
          (click)="
            teritory_id !== 0 &&
            teritory_id !== null &&
            teritory_id !== undefined
              ? buyNow(data)
              : openSuggestionModal()
          "
        >
          {{ "shop.buyNow" | translate }}
          <span
            *ngIf="loadingStates[data.ID]"
            class="spinner-border spinner-border-sm me-2"
          ></span>
        </button>
        <div class="text-center mt-3">
          <a
            (click)="!isLoading && openCouponModal(data)"
            [style.cursor]="isLoading ? 'not-allowed' : 'pointer'"
            [style.opacity]="isLoading ? '0.6' : '1'"
            [style.pointerEvents]="isLoading ? 'none' : 'auto'"
            class="d-inline-flex align-items-center gap-2 coupon-link text-13-500-blue"
          >
            <span>Have a coupon code?</span>
            <span
              *ngIf="isLoading"
              class="spinner-border spinner-border-sm size-14px"
            ></span>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
<div
  class="modal fade"
  id="guestModal"
  tabindex="-1"
  aria-labelledby="guestModalLabel"
  aria-hidden="true"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
>
  <div class="modal-dialog modal-dialog-centered">
    <div
      class="modal-content card-style"
    >
      <div class="modal-header border-0">
        <h5 class="fw-bold m-auto text-20-333" >
          <i class="bi bi-person-circle"></i> You are a Guest
        </h5>
        <button
          type="button"
          class="btn-close mx-0 px-0 ml-0"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <p class="text-15-555" >
          Please <strong>login</strong> to add an item to your cart and enjoy
          seamless service.
        </p>
      </div>
      <div class="modal-footer border-0 d-flex justify-content-center">
        <button
          type="button"
          class="btn btn-outline-dark px-4 py-2 rounded-pill border-black transition-500"
          data-bs-dismiss="modal"
        >
          <i class="bi bi-x-circle"></i> Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary px-4 py-2 rounded-pill btn-0052cc"
          (click)="redirectToLogin()"
        >
          <i class="bi bi-box-arrow-in-right"></i> Login
        </button>
      </div>
    </div>
  </div>
</div>
<div
  class="modal fade"
  id="suggestionModal"
  tabindex="-1"
  aria-labelledby="suggestionModalLabel"
  aria-hidden="true"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
>
  <div class="modal-dialog modal-dialog-centered">
    <div
      class="modal-content text-center p-4 position-relative suggestion-modal-content"
    >
      <button
        type="button"
        class="btn-close position-absolute top-right-10"
        (click)="closeSuggestionModal()"
        aria-label="Close"
      ></button>
      <div class="modal-body mt-2 suggestion-modal-body">
        <h5
          class="modal-title mb-3 text-16-600"
          id="suggestionModalLabel"
        >
          Product Not Deliverable
        </h5>
        <p class="text-muted mb-0 text-14">
          This product can’t be delivered to your location. Please select
          another location.
        </p>
      </div>
    </div>
  </div>
</div>
<div
  *ngIf="guestuser"
  class="modal fade show fullscreen-overlay"
  id="guestModal"
  tabindex="-1"
  aria-labelledby="guestModalLabel"
  aria-hidden="false"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
>
  <div
    class="modal-dialog modal-dialog-centered centered-container"
  >
    <div
      class="modal-content card-fadein"
    >
      <div class="modal-header border-0">
        <h5 class="fw-bold m-auto text-20-333" >
          <i class="bi bi-person-circle"></i> You are a Guest
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
          (click)="closeloginmodal()"
        ></button>
      </div>
      <div class="modal-body">
        <p class="text-15-555" >
          Please <strong>login</strong> to add an item to your cart and enjoy
          seamless service.
        </p>
      </div>
      <div class="modal-footer border-0 d-flex justify-content-center">
        <button
          type="button"
          class="btn btn-outline-dark px-4 py-2 rounded-pill border-black transition-500"
          data-bs-dismiss="modal"
          (click)="closeloginmodal()"
        >
          <i class="bi bi-x-circle"></i> Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary px-4 py-2 rounded-pill btn-0052cc"
          (click)="redirectToLogin()"
        >
          <i class="bi bi-box-arrow-in-right"></i> Login
        </button>
      </div>
    </div>
  </div>
</div>
<style>
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(40px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
<div
  class="modal fade"
  id="couponModal"
  tabindex="-1"
  aria-labelledby="couponModalLabel"
  aria-hidden="true"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-2">
      <div
        class="modal-header border-0 py-2 px-3 flex-column align-items-stretch bg-light-rounded"
        *ngIf="!newcoupons"
      >
        <div class="d-flex justify-content-between align-items-center mb-2">
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="d-flex align-items-center">
          <input
            type="text"
            class="form-control form-control-sm text-13-flex-1"
            *ngIf="couponcount > 0"
            [placeholder]="
              'order_review.coupon_modal.search_placeholder' | translate
            "
            [(ngModel)]="searchQuery"
          />
        </div>
      </div>
      <div
        class="border-0 p-3 bg-light-rounded"
        *ngIf="newcoupons"
      >
        <div
          class="d-flex align-items-center justify-content-between mb-2 border-bottom-light"
        >
          <button
            type="button"
            class="btn btn-sm d-flex align-items-center text-13"
            (click)="goBackFromCoupon()"
          >
            ←
          </button>
          <span class="ml-10">Coupon Code</span>
          <button
            type="button"
            class="btn-close"
            (click)="goBackFromCoupon()"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="d-flex align-items-center justify-content-between">
          <input
            type="text"
            class="form-control form-control-sm me-2 text-13-w-70"
            placeholder="Enter your coupon code"
            [(ngModel)]="searchQuery"
            name="couponCode"
            pattern="^[A-Za-z0-9]+$"
            #couponCode="ngModel"
            required
          />
          <button
            *ngIf="couponcount > 0 && !newcoupons"
            class="btn btn-sm btn-primary text-13-minw-60"
            (click)="applySelectedCoupon()"
            [disabled]="!couponCode.valid"
          >
            Apply
          </button>
          <button
            *ngIf="newcoupons"
            class="btn btn-sm btn-primary text-13-minw-60"
            (click)="newcouponadd(couponCode.value)"
            [disabled]="!couponCode.valid"
          >
            Apply
          </button>
        </div>
        <small
          class="text-danger mt-1 d-block"
          *ngIf="couponCode.invalid && couponCode.dirty"
        >
          Only letters and numbers are allowed.
        </small>
      </div>
      <span *ngIf="!newcoupons">
        <a class="ml-20-pointer-text"
          (click)="addCoupon()"
        >
          Have a coupon code?
        </a></span
      >
      <div
        class="modal-body text-center p-3 cursor-pointer-ptb"
      >
        <ng-container
          *ngIf="filteredCoupons.length > 0 && !newcoupons; else noCoupons"
        >
          <div
            *ngFor="let coupon of filteredCoupons"
            class="coupon-item d-flex justify-content-between align-items-center p-2 border-bottom small card-rounded-light"
            (click)="selectCoupon(coupon)"
            [class.selected]="selectedCoupon?.COUPON_ID === coupon.COUPON_ID"
            onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 4px 10px rgba(0, 0, 0, 0.15)';"
            onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';"
          >
            <div class="p-3 p3-3">
              <div class="text-start line-25">
                <h6
                  class="m-0 fw-bold text-dark text-14-600-black"
                >
                  {{
                    coupon?.COUPON_NAME ? coupon?.COUPON_NAME : "Coupon Applied"
                  }}
                </h6>
                <span
                  class="m-0 text-muted mt-0-text-12"
                  >Code : {{ coupon.COUPON_CODE }}</span
                >
                &nbsp; &nbsp;
                <span
                  *ngIf="coupon.COUPON_VALUE_TYPE == 'P'" class="badge-style"
                >
                  {{ coupon.COUPON_VALUE }}%
                  {{ "order_review.coupons.discount" | translate }}
                </span>
                <span
                  *ngIf="coupon.COUPON_VALUE_TYPE == 'A'" class="badge-style"
                >
                  &#8377;{{ coupon.COUPON_VALUE | number }}
                  {{ "order_review.coupons.discount" | translate }}
                </span>
              </div>
            </div>
            <div
              class="d-flex align-items-center gap-2"
            >
              <i
                class="bi"
                [ngClass]="
                  selectedCoupon?.COUPON_ID === coupon.COUPON_ID
                    ? 'bi-check-circle-fill text-success'
                    : 'bi-circle'
                "
              ></i>
            </div>
          </div>
        </ng-container>
        <ng-template #noCoupons>
          <div class="no-coupons text-center" *ngIf="!newcoupons">
            <img
              src="assets/img/hand-drawn-no-data-concept.png"
              alt="No Coupons"
              class="no-coupon-img mb-3 size-60x40"
            />
            <h6 class="fw-bold">
              {{ "order_review.coupon_modal.no_coupons" | translate }}
            </h6>
            <p class="text-muted small">
              {{ "order_review.coupons.no_coupons_message" | translate }}
            </p>
          </div>
        </ng-template>
      </div>
      <div class="modal-footer border-0 p-3" *ngIf="filteredCoupons.length > 0 && !newcoupons">
        <button
          class="btn btn-primary w-100 p-10-text-14-600"
          (click)="applySelectedCoupon()"
          [disabled]="!selectedCoupon"
        >
          {{ "order_review.coupon_modal.apply" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
<app-commonmap></app-commonmap>  