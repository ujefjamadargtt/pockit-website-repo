<div *ngIf="loadepage" class="loading-overlay">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>
<div class="modal fade" id="confirmtoaddaddress" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
  <div class="modal-dialog modal-lg d-flex justify-content-center">
    <div class="modal-content max-w-80" >
      <div class="modal-header">
        <h5 class="modal-title fw-bold">Confirm Address Change</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex align-items-center">
          Are you sure you want to change your address? Please note that after changing the address, your cart will be
          cleared.
        </div>
      </div>
      <div class="modal-footer d-flex flex-row">
        <button type="button" class="btn btn-outline-dark w-10 mt-2" (click)="ConfirmcloseAddressModal()">
          Cancel
        </button>
        <button type="button" class="btn btn-dark w-10" (click)="Procced()">
          Ok
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="addressModal1" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
  <div class="modal-dialog modal-lg d-flex justify-content-center">
    <div class="modal-content max-w-80">
      <div class="modal-header px-15-py-10" >
        <h5 class="modal-title fw-bold text-15">Select Address</h5>
        <button type="button"  class="btn-close text-12" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body  overflow-auto scrollable-400" >
        <div *ngFor="let address of addresses" [ngStyle]="((address.PINCODE_FOR === 'B' || address.PINCODE_FOR === 'S') && address.TERRITORY_ID == defaultAddress.TERRITORY_ID) 
        ? {} 
        : { 'display': 'none' }" class="border rounded p-2 mb-2 no-border-bottom" sclass="border rounded p-2 mb-2" >
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
              <input type="radio" name="address11" [value]="address.ID" [(ngModel)]="selectedAddress" />
              <div class="ms-2 text-small-preline">
                <span class="fw-bold">{{ address.NAME }}</span>
                <p class="text-muted mb-0">
                  {{ address?.ADDRESS_LINE_1 }} {{address?.ADDRESS_LINE_2}} {{address?.LANDMARK}},{{ address?.COUNTRY_NAME }} ,{{ address?.STATE_NAME }}, {{ address?.DISTRICT_NAME }} ,{{address?.PINCODE}}
                </p>
              </div>
            </div>
            <div *ngIf="customertype == 'I'">
              <button  class="btn btn-sm" (click)="editAddress(address)">
                <svg xmlns="http://www.w3.org/2000/svg" class="size-15"  width="15" height="15" viewBox="0 0 18 18" fill="none">
<path d="M14.3962 0.75V0.750977C14.7707 0.750051 15.1419 0.822538 15.488 0.96582L15.7409 1.08594C15.9878 1.21808 16.2145 1.38576 16.4128 1.58496H16.4118C16.9474 2.1198 17.2488 2.84564 17.2497 3.60254L17.236 3.88379C17.172 4.53733 16.8843 5.15192 16.4167 5.62109V5.62207L5.00458 17.0332C4.9704 17.0674 4.93323 17.0982 4.89325 17.125L4.76532 17.1934C4.72057 17.2119 4.67393 17.2259 4.62665 17.2354L4.48212 17.25H1.54852C1.49995 17.25 1.45141 17.2457 1.40399 17.2363L1.26532 17.1943C1.22047 17.1758 1.17756 17.1528 1.13739 17.126L1.02606 17.0332C0.991738 16.9989 0.960122 16.962 0.933289 16.9219L0.864929 16.7939C0.827811 16.7043 0.809209 16.6078 0.809265 16.5107V13.5771L0.822937 13.4336C0.850838 13.2922 0.920107 13.1605 1.02313 13.0566H1.02411L12.3688 1.5957L12.5759 1.40527C12.7919 1.22558 13.0344 1.07864 13.2946 0.969727L13.5583 0.874023C13.8271 0.791678 14.1072 0.749958 14.3893 0.75H14.3962ZM2.2868 13.8809V15.7725H4.17645L13.7067 6.24219L11.7673 4.30273L2.2868 13.8809ZM14.3913 2.22754C14.2556 2.22749 14.1211 2.24846 13.9919 2.28809L13.8649 2.33398C13.6983 2.4038 13.5472 2.50598 13.4206 2.63477H13.4196L12.8073 3.25293L14.7507 5.19629L15.3718 4.57617C15.6286 4.31834 15.7731 3.96943 15.7731 3.60547C15.7731 3.24132 15.6288 2.89169 15.3718 2.63379L15.3659 2.62891L15.362 2.62402C15.243 2.49025 15.0947 2.38499 14.9294 2.31641C14.8052 2.26492 14.6733 2.23485 14.5397 2.22754H14.3913Z" fill="#2A3B8F" stroke="#2A3B8F" stroke-width="0.5"/>
</svg>
              </button>
              <button  *ngIf="!address.IS_DEFAULT" class="btn btn-sm text-danger" (click)="deleteAddress(address.ID)">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer d-flex flex-column border-top-none">
        <button type="button" class="btn btn-dark w-100" (click)="ConfirmopenAddressModal('select')">
          Select
        </button>
      </div>
    </div>
  </div>
</div>
<p class="device-type text-13-mb2">
  {{ "servicejson.selected_service" | translate }} :
  <span class="text-danger fw-bold text-14-ellipsis"
    [attr.title]="data.NAME || 'N/A'" data-bs-toggle="tooltip" data-bs-placement="top">
    {{ (data.NAME?.length > 40) ? (data.NAME | slice:0:40) + '...' : (data.NAME || 'N/A') }}
  </span>
</p>
<p class="text-muted text-12" >
  {{ "servicejson.enter_details" | translate }}
</p>
<div *ngIf="defaultAddress" (click)="openAddressModal()" class="border rounded p-3 mb-2 cursor-shadow-text13"
  >
  <div class="d-flex justify-content-between align-items-center">
    <span class="fw-bold text-14" >
      üè† {{ defaultAddress.ADDRESS_LINE_1 }},
      {{ defaultAddress.DISTRICT_NAME }}
    </span>
    <i class="bi bi-chevron-right"></i>
  </div>
  <p class="text-muted mb-0 pl-25-text-12">
    {{ defaultAddress.ADDRESS_LINE_2 }}, {{ defaultAddress.PINCODE }}
  </p>
</div>
<div class="border rounded p-3 bg-light shadow-sm bg-white-border-light" >
  <p class="fw-bold mb-1 text-14-ellipsis" 
    [attr.title]="data.NAME" data-bs-toggle="tooltip" data-bs-placement="top">
    {{ (data.NAME?.length > 40) ? (data.NAME | slice:0:40) + '...' : (data.NAME || 'N/A') }}
  </p>
  <div  *ngIf="customertype !== 'B'" class="d-flex justify-content-between text-muted">
    <span class="text-12" >{{
      "servicejson.base_price" | translate
      }}</span>
    <span *ngIf="customertype !== 'B'" class="fw-bold text-13" >‚Çπ {{ (data.B2C_PRICE| number) || "0" }}</span>
  </div>
  <div class="d-flex justify-content-between text-muted">
    <span class="text-12" > {{ customertype === 'B' ? 'Estimated Duration' : 'Estimated Duration' }}
    </span>
    <span class="fw-bold text-13" >
                      {{(data?.DURARTION_HOUR || 0) * 60 + (data?.DURARTION_MIN || 0)}} min
    </span>
  </div>
  <div class="d-flex justify-content-between align-items-center mt-2">
    <span class="text-12" >{{
      "servicejson.quantity" | translate
      }}</span>
    <div class="input-group qty-box">
      <button class="btn btn-outline-secondary btn-sm text-12" (click)="decreaseQty()" >
        -
      </button>
      <input type="text" class="form-control text-center text-12" [(ngModel)]="quantity" (ngModelChange)="changeData($event)"
        readonly name="any"  />
      <button class="btn btn-outline-secondary btn-sm text-12" (click)="increaseQty()" >
        +
      </button>
    </div>
  </div>
</div>
<div class="mt-3 border rounded p-3 shadow-sm pb-120">
  <div class="d-flex justify-content-between align-items-center">
    <label class="form-label text-muted mb-0 text-12" > {{ "servicejson.brand_name" | translate }}</label>
    <span class="text-muted text-12" >(Optional)</span>
  </div>
  <input type="text" class="form-control custom-input text-12" [(ngModel)]="data.BRAND_NAME" placeholder="Enter brand name"
  maxlength="128" (focus)="isFocused = 'BRAND_NAME'" (blur)="isFocused = ''" />
  <h6 class="text-red-xs-mt4"  *ngIf="
  isFocused === 'BRAND_NAME' ||
  (data.BRAND_NAME != undefined &&
    data.BRAND_NAME != null &&
    data.BRAND_NAME != '' &&
    isFocused === 'BRAND_NAME')
">
    {{ data?.BRAND_NAME?.length || 0 }}/128
  </h6>
  <div class="d-flex justify-content-between align-items-center mt-3">
    <label class="form-label text-muted mb-0 text-12" > {{ "servicejson.model_number" | translate }}</label>
    <div class="d-flex align-items-center">
      <span class="text-muted me-1 text-12" >(Optional)</span>
      <i class="bi bi-info-circle text-primary cursor-pointer-text-12"  data-bs-toggle="modal"
        data-bs-target="#modelNumberModal"></i>
    </div>
  </div>
  <input type="text" class="form-control custom-input text-12" [(ngModel)]="data.MODEL_NUMBER" placeholder="Enter model number"
     maxlength="60" (focus)="isFocused = 'MODEL_NUMBER'" (blur)="isFocused = ''" />
  <h6 class="text-red-xs-mt4"  *ngIf="
  isFocused === 'MODEL_NUMBER' ||
  (data.MODEL_NUMBER != undefined &&
    data.MODEL_NUMBER != null &&
    data.MODEL_NUMBER != '' &&
    isFocused === 'MODEL_NUMBER')
">
    {{ data?.MODEL_NUMBER?.length || 0 }}/60
  </h6>
  <div class="d-flex justify-content-between align-items-center mt-3">
    <label class="form-label text-muted mb-0 text-12" >{{
      "servicejson.upload_photo" | translate
      }}</label>
    <div class="d-flex align-items-center">
      <span class="text-muted me-1 text-12" >(Optional)</span>
      <i class="bi bi-info-circle text-primary cursor-pointer-text-12"  data-bs-toggle="modal"
        data-bs-target="#uploadPhotoModal1"></i>
    </div>
  </div>
  <div class="upload-container d-flex align-items-center px-3">
    <span *ngIf="!data.SERVICE_PHOTO_FILE"  class="placeholder-text text-12"> {{ "servicejson.browse_photo" |translate }}</span>
    <span *ngIf="data.SERVICE_PHOTO_FILE"  class="text-truncate file-name text-12"
      title="{{ data.SERVICE_PHOTO_FILE }}">
      {{
      data.SERVICE_PHOTO_FILE.length > 36
      ? (data.SERVICE_PHOTO_FILE | slice : 0 : 36) + "..."
      : data.SERVICE_PHOTO_FILE
      }}
    </span>
    <input #icon type="file" accept=".png, .jpg, .jpeg" (change)="fileChangeEvent($event)" class="file-input text-122"
      />
    <i *ngIf="!data.SERVICE_PHOTO_FILE" (change)="fileChangeEvent($event)" class="bi bi-upload upload-icon"
      (click)="icon.click()"></i>
    <div *ngIf="data.SERVICE_PHOTO_FILE" class="d-flex align-items-center ms-2">
      <a href="javascript:void(0)" class="text-primary me-2" (click)="openModal()">
        <i class="bi bi-eye"></i>
      </a>
      <a href="javascript:void(0)" class="text-danger" (click)="removeImage()">
        <i class="bi bi-trash"></i>
      </a>
    </div>
  </div>
  <div *ngIf="isUploading" class="progress mt-2">
    <div class="progress-bar" role="progressbar" [style.width.%]="progressPercent"></div>
  </div>
  <div *ngIf="showModal" class="custom-modal">
    <div class="modal-content">
      <span  class="custom-close-btn cursor-pointer" (click)="closeModal()">&times;</span>
      <img  [src]="imagePreview" class="modal-img position-relative" alt="Uploaded Image" />
    </div>
  </div>
  <div class="d-flex justify-content-between align-items-center mt-3">
    <label class="form-label text-muted mb-0 text-12" >
      {{"servicejson.add_description" | translate}}</label>
    <span class="text-muted text-12" >(Optional)</span>
  </div>
  <textarea class="form-control custom-input text-12" rows="3" [(ngModel)]="data.DESCRIPTION" placeholder="Enter description"
     maxlength="256" (focus)="isFocused = 'DESCRIPTION'" (blur)="isFocused = ''"></textarea>
  <h6 class="text-red-xs-mt4"  *ngIf="
  isFocused === 'DESCRIPTION' ||
  (data.DESCRIPTION != undefined &&
    data.DESCRIPTION != null &&
    data.DESCRIPTION != '' &&
    isFocused === 'DESCRIPTION')
">
    {{ data?.DESCRIPTION?.length || 0 }}/256
  </h6>
</div>
<div class="drawer-footer mt-auto border-top pt-3 footer-absolute">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-12 text-center text-md-start mb-2 mb-md-0 flex-justify-end">
        <button class="btn btn-outline-secondary bg-light-text-black-12" (click)="close()" data-bs-dismiss="offcanvas"
          >
          {{ "servicejson.back" | translate }}
        </button>
        <button *ngIf="InCart" class="btn btn-success px-3 ml-12"
          [routerLink]="'/shop/cart'">
          <i class="bi bi-cart-fill"></i>
          <span class="ms-2">{{"servicejson.go_to_cart" | translate}}</span>
        </button>
        <button (click)="openDrawer2(data)" class="btn btn-dark btn-blue-12" [disabled]="!data?.CATEGORY_NAME">
       {{ "servicejson.next" | translate }}
      <span class="text-muted text-white-12">
        ({{ "servicejson.select_address_slot" | translate }})
      </span>
    </button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="modelNumberModal" tabindex="-1" aria-labelledby="modelNumberModalLabel" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title fw-bold text-blue-dark-14" id="modelNumberModalLabel" >
          How to Find Model Number
        </h6>
        <button type="button" class="btn-close text-13" data-bs-dismiss="modal" aria-label="Close"
          ></button>
      </div>
      <div class="modal-body text-center">
        <p class="mb-1 text-justify-13" >
          Check the underside of your laptop for a sticker or engraving labeled
          "Model" or "Model No." Refer to the image below for guidance.
        </p>
        <img src="assets/img/laptopproductno.png" class="img-fluid rounded shadow-sm" alt="Model Number Guide" />
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="uploadPhotoModal1" tabindex="-1" aria-labelledby="uploadPhotoModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title fw-bold text-blue-dark-14" id="uploadPhotoModalLabel" >
          How to Upload a Photo
        </h6>
        <button type="button" class="btn-close text-13" data-bs-dismiss="modal" aria-label="Close"
          ></button>
      </div>
      <div class="modal-body text-center">
        <p class="mb-1 text-justify-13" >
          Make sure the photo clearly shows your device details.
        </p>
        <img src="assets/img/Laptopmodalno.jfif" class="img-fluid rounded shadow-sm" alt="Upload Photo Guide" />
      </div>
    </div>
  </div>
</div>
<div class="offcanvas offcanvas-end custom-drawer1 w-500" data-bs-backdrop="static" tabindex="-1" id="addressSlotDrawer22"
  >
  <div class="offcanvas-header border-bottom">
    <h5 class="offcanvas-title fw-bold text-14" >
      Select Slot  
    </h5>
    <button type="button" class="btn-close" (click)="backaddress()" data-bs-dismiss="offcanvas"></button>
  </div>
  <div *ngIf="userID !== 0" class="progress">
    <div class="progress-bar bg-orange-custom" role="progressbar"
      [style.width.%]="progress" [attr.aria-valuenow]="progress" aria-valuemin="0" aria-valuemax="100"></div>
  </div>
  <div class="offcanvas-body">
    <div *ngIf="data?.IS_EXPRESS === 1" class="border rounded p-3 bg-light shadow-13"
      >
      <div class="d-flex align-items-center">
        <input type="radio" id="expressService" name="serviceOption" checked class="me-2" />
        <label for="expressService" class="fw-bold text-14" >
          <i>Express Service</i>
        </label>
      </div>
      <p class="text-muted text-12" >
        Same day service with our express checkout option with an additional
        charge of
        <b>{{ data?.EXPRESS_COST ? data.EXPRESS_COST + " INR" : "N/A" }}</b>.
      </p>
      <div *ngIf="data?.IS_EXPRESS === 1" class="d-flex justify-content-center mt-2">
        <button class="btn w-50-text-13" [ngClass]="{
            'btn-outline-primary': IS_EXPRESS === 0,
            'btn-outline-danger': IS_EXPRESS === 1
          }"  (click)="toggleExpressService()">
          {{
          IS_EXPRESS === 1 ? "Remove Express Service" : "Use Express Service"
          }}
        </button>
      </div>
    </div>
    <p class="text-center mt-3 text-13" >
      Please select a date and time for the technician's visit
    </p>
    <div class="border date-time-container shadow-13" >
      <div class="date-picker-container">
        <label class="form-label text-13" >Select a date</label>
        <p class="selected-date text-12" >
          {{ selectedDate }}
        </p>
        <div class="date-scroll">
          <button *ngFor="let date of dates" class="date-button text-12" [ngClass]="{
              selected: selectedDate.trim() === date.fullDate.trim()
            }" (click)="selectDate(date.fullDate)"  >
            <span class="day">{{ date.display.split(" ")[0] }}</span>
            <span class="date">{{ date.display.split(" ")[1] }}</span>
          </button>
        </div>
      </div>
      <div class="time-slot-container">
        <label class="form-label fw-bold text-13" >
          Select a time slot
        </label>
        <div class="time-slot-wrapper">
          <div *ngFor="let period of timeSlots" class="time-slot">
            <p class="slot-title text-left-13">
              {{ period.period }}
            </p>
            <button class="slot-button" [ngClass]="{
                'selected-slot':
                  selectedSlot ===
                  formatTime(period.times.start) +
                    ' - ' +
                    formatTime(period.times.end)
              }" (click)="selectSlot(period.times)" [disabled]="period.times.disabled">
              <span class="time-range">
                {{ formatTime(period.times.start) }}<br />-<br />{{
                formatTime(period.times.end)
                }}
              </span>
            </button>
          </div>
        </div>
      </div>
      <p *ngIf="isAllSlotsDisabled()" 
      class="no-slots-message text-red-14" 
      >
      No time slots are available for the selected date. 
       </p>
    </div>
    <div class="border p-3 mt-3 card-rounded-shadow-13">
      <label class="form-label fw-bold text-13" >Remarks</label>
      <input type="text" class="form-control text-12" [(ngModel)]="remark"
    [placeholder]="'home.remarks_placeholder' | translate"  maxlength="256"
    (focus)="isFocused = 'REMARK'" (blur)="isFocused = ''" />
  <h6 *ngIf="isFocused === 'REMARK'" class="text-red-10-mt4">
    {{ remark?.length || 0 }}/256
  </h6>
    </div>
  </div>
  <div class="offcanvas-footer border-top p-3 d-flex align-items-center">
    <button class="btn btn-outline-secondary flex-grow-0 me-2 text-13" (click)="backaddress()" data-bs-dismiss="offcanvas"
      >
      Back
    </button>
    <button class="btn btn-light flex-grow-0 me-2">
    </button>
    <button class="btn btn-dark flex-grow-1 text-white text-14" (click)="bookNow()" >
      Confirm
    </button>
  </div>
</div>