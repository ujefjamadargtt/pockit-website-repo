<!-- <button (click)=openmapModal2() class="btn btn-outline-primary">Back</button> -->
<!-- <div #mapContainer class="map-container"></div> -->
<!-- {{currentterritory}} -->

<div class="container mt-4" *ngIf="orderDetails">
  <!-- <div class="card p-4 shadow" style="border: none;box-shadow: none !important;"> -->
  <div class="card p-2 p-md-4 shadow" style="border: none; box-shadow: none !important">
    <div class="row">
      <!-- Left Section -->
      <div class="col-md-6 mb-2 mb-md-0">
        <h2 style="font-size: 20px !important; font-weight: 700 !important" class="mb-3">
          {{ "order_details.title" | translate }}
        </h2>
        <div *ngIf="
            isShowMenu() &&
            currentterritory !== undefined &&
            currentterritory !== null &&
            currentterritory !== 0 &&
            currentterritory !== '' &&
            currentterritory !== 'undefined'
          " class="position-absolute top-0 end-0 p-3 pt-1">
          <div ngbDropdown class="d-inline-block">
            <button class="btn btn-light newclass" ngbDropdownToggle>
              <i class="bi bi-three-dots-vertical"></i>
            </button>

            <ul style="padding: 2px;" ngbDropdownMenu class="dropdown-menu-end">
              <li *ngIf="
                  isShowReschedule() &&
                  currentterritory !== undefined &&
                  currentterritory !== null &&
                  currentterritory !== 0 &&
                  currentterritory !== '' &&
                  currentterritory !== 'undefined'
                ">
                <a style="cursor: pointer; font-size: 13px;" class="dropdown-item" (click)="openDrawer('reschedule')">
                  <i class="bi bi-arrow-clockwise me-2" style="color: #2a3b8f !important"></i>
                  &nbsp;{{ "order_details.reschedule" | translate }}
                </a>
              </li>
              <li *ngIf="
                  isShowCancel() &&
                  currentterritory !== undefined &&
                  currentterritory !== null &&
                  currentterritory !== 0 &&
                  currentterritory !== '' &&
                  currentterritory !== 'undefined'
                ">
                <a style="cursor: pointer; font-size: 13px;" class="dropdown-item" (click)="openDrawer('cancel')">
                  <i class="bi bi-x-circle me-2"></i>{{ "order_details.cancel" | translate }}
                </a>
              </li>
              <li *ngIf="isShowDownload()">
                <a style="cursor: pointer; font-size: 13px;" class="dropdown-item" (click)="onDownloadInvoice()"
                  [class.disabled]="isDownloading">
                  <i class="bi bi-file-earmark-arrow-down me-2" style="color: #2a3b8f"></i>
                  {{ "order_details.download_invoice" | translate }}
                  <span *ngIf="isDownloading" style="font-weight: bold"
                    class="spinner-border spinner-border-sm ms-2"></span>
                </a>
              </li>

              <!-- <li>
                <a
                  style="cursor: pointer"
                  class="dropdown-item"
                  (click)="openticketdrawer()"
                >
                  <i
                    class="bi bi-ticket-detailed me-2"
                    style="color: #2a3b8f"
                  ></i>
                  {{ "Raise Ticket" }}
                </a>
              </li> -->
            </ul>
          </div>
        </div>

        <!-- cancelDrawer -->

        <div class="offcanvas offcanvas-end" tabindex="-1" id="cancelDrawer" aria-labelledby="cancelDrawerLabel"
          data-bs-backdrop="static">
          <!-- Header -->
          <div class="offcanvas-header border-bottom">
            <h5 class="fw-bold mb-0" id="cancelDrawerLabel" style="font-size: 14px">
              {{ "order_details.cancel_order" | translate }}
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
          </div>

          <!-- Body: Flex column, grow content -->
          <div class="offcanvas-body d-flex flex-column" style="background-color: #f5f8ff">
            <!-- Spinner while loading -->
            <div *ngIf="reasonsisLoading" class="d-flex justify-content-center align-items-center"
              style="height: 200px">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden"> Loading...</span>
              </div>
            </div>

            <!-- Content when loaded -->
            <div *ngIf="!reasonsisLoading" class="flex-grow-1">
              <label class="form-label fw-semibold mb-3" style="font-size: 14px;">{{
                "order_details.select_cancellation_reason" | translate
                }}</label>
              <div class="border rounded-3 p-3 bg-white shadow-sm" style="font-size: 13px">
                <div class="responsive-scroll">
                  <div *ngFor="let reason of cancelReasons; let i = index" class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" [id]="'reason' + i" [value]="reason"
                      [(ngModel)]="reason.selected" />
                    <label class="form-check-label" [for]="'reason' + i">
                      {{ reason.label }}
                    </label>
                  </div>
                </div>

                <!-- Textarea -->
                <div class="form-group mt-2" style="font-size: 13px !important">
                  <textarea style="width: 100% ; font-size: 13px !important" class="form-control rounded-3" rows="3"
                    [placeholder]="'order_details.describe_problem' | translate" [(ngModel)]="comment"></textarea>
                </div>
              </div>
            </div>

            <!-- Sticky Footer -->
            <div *ngIf="!isLoading" class="drawer-footer mt-auto d-flex justify-content-between border-top pt-3">
              <button class="btn btn-primary w-100 rounded-3 d-flex align-items-center justify-content-center"
                [disabled]="loading" (click)="openConfirmModal()">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                {{ "order_details.cancel_order" | translate }}
              </button>
            </div>

            <!-- Confirmation Modal -->
            <div class="modal fade" id="confirmCancelModal" tabindex="-1" data-bs-backdrop="static"
              data-bs-keyboard="false" aria-labelledby="confirmCancelLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="confirmCancelLabel">
                      {{ "order_details.confirm_cancellation" | translate }}
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    {{ "order_details.confirm_cancel_message" | translate }}
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                      {{ "order_details.no" | translate }}
                    </button>
                    <button type="button" class="btn btn-danger" (click)="confirmCancel()">
                      {{ "order_details.yes_cancel" | translate }}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- rescheduleDrawer -->

        <div class="offcanvas offcanvas-end" tabindex="-1" id="rescheduleDrawer" aria-labelledby="rescheduleDrawerLabel"
          data-bs-backdrop="static">
          <!-- Header -->
          <div class="offcanvas-header border-bottom">
            <h5 class="fw-bold mb-0" id="rescheduleDrawerLabel" style="font-size: 14px">
              {{ "order_details.reschedule_order" | translate }}
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
          </div>

          <!-- Body: Flex column -->
          <div class="offcanvas-body d-flex flex-column" style="background-color: #f5f8ff">
            <!-- Spinner -->
            <div *ngIf="rescheduleLoading" class="d-flex justify-content-center align-items-center"
              style="height: 200px">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>

            <!-- Content -->
            <div *ngIf="!rescheduleLoading" class="flex-grow-1">
              <label class="form-label fw-semibold mb-3" style="font-size: 14px;">{{
                "order_details.select_reschedule_reason" | translate
                }}</label>
              <div class="border rounded-3 p-3 bg-white shadow-sm" style="font-size: 13px">
                <div class="responsive-scroll">
                  <div *ngFor="let reason of rescheduleReasons; let i = index" class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" [id]="'rescheduleReason' + i" [value]="reason"
                      [(ngModel)]="reason.selected" />
                    <label class="form-check-label" [for]="'rescheduleReason' + i">
                      {{ reason.label }}
                    </label>
                  </div>
                </div>

                <!-- Textarea -->
                <div class="form-group mt-2" style="font-size: 13px !important">
                  <textarea style="width: 100% ; font-size: 13px !important" class="form-control rounded-3" rows="3"
                    [placeholder]="'order_details.describe_problem' | translate"
                    [(ngModel)]="rescheduleComment"></textarea>
                </div>
              </div>
            </div>

            <!-- Sticky Footer -->
            <div class="drawer-footer mt-auto d-flex justify-content-between border-top pt-3">
              <button class="btn btn-primary w-100 rounded-3 d-flex align-items-center justify-content-center"
                [disabled]="loading" (click)="proceedReschedule(this.orderGetDetails)">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                {{ "order_details.next_select_date_time" | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- time slot drawer -->

    <div style="width: 700px" class="offcanvas offcanvas-end" data-bs-backdrop="static" tabindex="-1"
      id="rescheduletimeslotdrawer" aria-labelledby="offcanvasRightLabel" [class.show]="isDrawerVisible">
      <div *ngIf="!loadepage" class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title fw-bold" style="font-size: 14px">
          {{ "order_details.select_date_slot" | translate }}
        </h5>
        <button type="button" class="btn-close" (click)="drawerClose()"></button>
      </div>
      <div *ngIf="!loadepage" class="demodash offcanvas-body d-flex flex-column">
        <app-reschedule-time-slot-drawer *ngIf="userID !== 0" [data]="drawerData" [selectedReasons]="rescheduleReasons"
          [rescheduleComment]="rescheduleComment" [closeDrawerEvent]="closeCallback"></app-reschedule-time-slot-drawer>
      </div>
    </div>

    <div class="row">
      <!-- Left Section -->
      <div class="col-md-6">
        <!-- Accordion Section -->
        <div class="accordion">
          <div class="accordion-item mb-2 shadow-sm rounded" style="
              border-radius: 16px !important;
              margin-bottom: 17px !important;
            ">
            <!-- <h2
              class="accordion-header"
              (click)="toggleAccordion('orderStatus')"
            >
              <button
                class="accordion-button fw-bold d-flex align-items-center gap-2"
                [class.collapsed]="!orderDetailsVisible['orderStatus']"
              >
                <i class="bi bi-list-check text-primary"></i> Order Status
              </button>
            </h2> -->
            <div style="border-radius: 16px; border-color: #cbcbcb; border: none" class="card">
              <div class="card-body">
                <!-- Header -->
                <div class="d-flex justify-content-between align-items-center">
                  <h5 class="fw-bold d-flex align-items-center ml">
                    <img src="assets/img/Vector.svg" alt="Icon" width="16" height="16"
                      style="margin-right: 2px" />&nbsp;
                    {{ "order_details.order_details" | translate }}
                  </h5>
                  <!-- <i  #popoverButton class="bi bi-info-circle text-muted"></i> -->
                  <!-- <i class="bi bi-info-circle text-muted"></i> -->

                  <span style="
                      font-weight: 600;
                      padding: 4px;
                      background-color: #fff;
                      border-radius: 8px;
                      color: #2a3b8f;
                      font-size: 14px !important;
                    ">
                    <!-- Services:  -->
                    {{ "header.services" | translate }} :

                    {{ orderGetDetails.length }}
                  </span>
                  <!-- main.component.html -->
                  <!-- <button #popoverButton type="button" class="btn btn-primary">
  <i class="bi bi-eye"></i> View Status
</button> -->
                </div>
                <hr style="color: #747678" class="my-2" />

                <!-- Show spinner while loading -->
                <div *ngIf="isLoading" class="d-flex justify-content-center my-3">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>

                <!-- Show Order Details if data is available -->
                <ng-container *ngIf="!isLoading && orderGetDetails.length > 0">
                  <p style="
                      font-size: 14px !important;
                      margin-bottom: 12px !important;
                    " class="mb-2 d-flex justify-content-between">
                    <strong>{{ "order_details.order_id" | translate }}:</strong>
                    <span style="font-weight: 500; color: #0e0e0e" class="text-dark">{{ orderGetDetails[0]?.ORDER_NUMBER
                      }}</span>
                  </p>

                  <!-- Status History Accordion -->
                  <div class="accordion-item mb-2 shadow-sm rounded" style="
                      border-radius: 16px !important;
                      margin-bottom: 17px !important;
                    ">
                    <button class="btn w-100 text-start fw-semibold d-flex justify-content-between align-items-center"
                      type="button" style="
                        background: #fff;
                        border-radius: 16px;
                        padding-bottom: 10px;
                        padding-top: 11px;
                      " (click)="toggleAccordionStatus()" [class.collapsed]="!isAccordionOpenStatus">
                      <!-- Dynamically show Last Status title -->
                      <span>
                        <i class="bi bi-clock-history text-primary" style="color: #2a3b8f !important"></i>
                        &nbsp; {{ "order_details.order_status" | translate }}:
                        <ng-container *ngIf="
                            orderDetails.statusHistory?.length > 0;
                            else noStatus
                          ">
                          {{
                          orderDetails.statusHistory[
                          orderDetails.statusHistory.length - 1
                          ]?.title
                          }}
                        </ng-container>
                        <ng-template #noStatus>
                          {{ "order_details.no_status_available" | translate }}
                        </ng-template>
                      </span>

                      <i class="bi" [ngClass]="{
                          'bi-chevron-down': !isAccordionOpenStatus,
                          'bi-chevron-up': isAccordionOpenStatus
                        }"></i>
                    </button>

                    <!-- Collapsible Content -->
                    <div class="accordion-collapse" [class.show]="isAccordionOpenStatus">
                      <div class="offcanvas-body">
                        <div class="accordion-body p-2">
                          <!-- Timeline -->
                          <div class="status-container">
                            <ul class="list-unstyled position-relative">
                              <li *ngFor="
                                  let status of orderDetails.statusHistory;
                                  let last = last
                                " class="status-item d-flex align-items-start">
                                <i [class]="
                                    status.completed
                                      ? 'bi bi-check-circle text-success'
                                      : 'bi bi-circle text-secondary'
                                  " class="status-icon me-2"></i>

                                <div>
                                  <p class="mb-0 fw-semibold" [class.text-dark]="status.completed">
                                    {{ status.title }},
                                    <span class="text-muted" style="font-size: 10px !important">{{ status.date }}</span>
                                  </p>
                                  <!-- Optional description -->
                                  <!--
                <p *ngIf="status.description" class="small text-muted">
                  {{ status.description }}
                </p>
                -->
                                </div>

                                <div *ngIf="!last" class="status-line"></div>
                              </li>
                            </ul>
                          </div>

                          <!-- Message if no status -->
                          <div *ngIf="!orderDetails.statusHistory?.length" class="text-center text-muted">
                            {{
                            "order_details.no_status_history_available"
                            | translate
                            }}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <!-- Left Section -->
                    <div class="col-md-12">
                      <div style="
                          border-radius: 16px !important;
                          padding: 10px !important;
                          margin-bottom: 10px !important;
                        " *ngFor="let item of orderGetDetails; let i = index"
                        class="card border rounded p-3 shadow-sm mb-1" [ngStyle]="{
                          'background-color':
                            selectedIndex === i ? '#f9e8d657' : 'white'
                        }" (click)="setSelectedCard(i)">
                        <div class="card-body" style="padding: 2px">
                          <div class="d-flex align-items-center gap-3 position-relative"
                            style="justify-content: end !important">
                            <div (click)="orderData?.[0]?.ORDER_STATUS === 'OR' ? showToast() : toggleCollapse(i, item)"
                              class="bottom-0 end-0 text-end show-details-btn">
                              <span style="margin-right: 8px" class="btn-text">
                                <!-- Show Details -->
                                {{ "order_details.Show_Details" | translate }}
                              </span>
                              <i class="bi bi-arrow-right-circle-fill"></i>
                            </div>
                            <!-- {{ item.JOB_STATUS }} {{ item.JOB_COMPLETED_DATETIME }} -->
                            <!-- <div
                              *ngIf=" (item.JOB_CARD_ID !== null && item.JOB_CARD_ID !== undefined && item.JOB_CARD_ID !== 0) && (currentterritory!==undefined && currentterritory!==null && currentterritory!==0 && currentterritory!=='' && currentterritory!=='undefined')"
                              class="bottom-50 end-0 text-end show-details-btn"> -->

                            <!-- {{currentterritory}} -->
                            <div *ngIf="
                                item.JOB_STATUS === 'CO' &&
                                item.JOB_CARD_ID !== null &&
                                item.JOB_CARD_ID !== undefined &&
                                item.JOB_CARD_ID !== 0 &&
                                currentterritory !== 0
                              " class="bottom-50 end-0 text-end show-details-btn">
                              <div ngbDropdown class="d-inline-block">
                                <button class="btn btn-light newclass" ngbDropdownToggle style="padding: 0px 5px"
                                  (click)="sendjobid(item)">
                                  <i class="bi bi-three-dots-vertical"></i>
                                </button>
                                <ul ngbDropdownMenu class="dropdown-menu-end">
                                  <li>
                                    <a style="cursor: pointer" class="dropdown-item" (click)="openticketdrawer(item)">
                                      <i class="bi bi-ticket-detailed me-2" style="color: #2a3b8f"></i>
                                      {{ "Raise Support Ticket" }}
                                    </a>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                          <!-- Service Name & Icon -->
                          <div class="d-flex align-items-center gap-3 position-relative">
                            <!-- Service Icon -->
                            <div
                              class="service-icon d-flex align-items-center justify-content-center rounded-circle bg-light"
                              style="width: 40px; height: 40px">
                              <img [src]="
                                  item.SERVICE_IMAGE
                                    ? IMAGEuRL + 'Item/' + item.SERVICE_IMAGE
                                    : 'assets/img/services/no-image.png'
                                " class="rounded-circle" alt="Service Icon" style="width: 40px; height: 40px" />
                            </div>

                            <!-- Service Name & Order ID -->
                            <div>
                              <h6 class="fw-bold mb-0">
                                {{ item.SERVICE_NAME }}
                              </h6>
                            </div>

                            <!-- Show Details -->
                          </div>

                          <hr style="border: 1px solid #e7e6e6; margin: 11px" />

                          <!-- Date & Time -->
                          <div class="cart-bottom" style="padding: 0px">
                            <div class="cart-icon">
                              <i class="bi bi-clock" style="
                                  color: #2a3b8f !important;
                                  font-size: 12px !important;
                                "></i>
                            </div>
                            <span style="font-weight: 500">
                              <ng-container
                                *ngIf="orderData?.[0]?.ORDER_DATE_TIME !== 'Not Mentioned'; else notMentioned">
                                {{
                                orderData?.[0]?.ORDER_DATE_TIME ? (orderData?.[0]?.ORDER_DATE_TIME | date : "EEE, MMM d
                                'at' h:mm a") : ''
                                }}
                              </ng-container>
                              <ng-template #notMentioned>{{
                                "order_details.not_mentioned" | translate
                                }}</ng-template>
                            </span>
                          </div>

                          <!-- Collapsible Details -->
                          <div class="mt-2">
                            <hr style="border: 1px solid #e7e6e6; margin: 0px" />

                            <button class="btn w-100 text-start d-flex justify-content-between align-items-center"
                              (click)="item.isOpen2 = !item.isOpen2" style="
                                background: transparent;
                                border: none;
                                outline: none;
                                box-shadow: none;
                                padding-bottom: 0px !important;
                              ">
                              <span class="fw-bold" style="
                                  font-size: 14px !important;
                                  font-weight: 600 !important;
                                ">{{ "order_review.details" | translate }}</span>
                              <i class="bi" style="color: #2a3b8f !important" [ngClass]="{
                                  'bi-chevron-down': !item.isOpen2,
                                  'bi-chevron-up': item.isOpen2
                                }" class="text-primary"></i>
                            </button>

                            <div *ngIf="item.isOpen2" class="mt-2">
                              <hr style="color: #f0f5fc" class="my-2" />

                              <div class="myclass p-3">
                                <div class="d-flex justify-content-between">
                                  <p class="fw-bold mb-1" style="color: #636363 !important">
                                    {{ "order_details.device" | translate }}:
                                  </p>
                                  <p class="mb-1" style="
                                      color: #0e0e0e !important;
                                      font-weight: 500 !important;
                                    ">
                                    {{ item.CATEGORY_NAME }}
                                  </p>
                                </div>
                                <div class="d-flex justify-content-between">
                                  <p class="fw-bold mb-1" style="color: #636363 !important">
                                    {{ "order_details.type" | translate }}:
                                  </p>
                                  <p class="mb-1" style="
                                      color: #0e0e0e !important;
                                      font-weight: 500 !important;
                                    ">
                                    {{ item.SUB_CATEGORY_NAME }}
                                  </p>
                                </div>
                                <div class="d-flex justify-content-between">
                                  <p class="fw-bold mb-1" style="color: #636363 !important">
                                    {{ "order_details.service" | translate }}:
                                  </p>
                                  <p class="mb-1" style="
                                      color: #0e0e0e !important;
                                      font-weight: 500 !important;
                                    ">
                                    {{ item.SERVICE_NAME }}
                                  </p>
                                </div>
                                <div *ngIf="item.IS_EXPRESS == 1" class="d-flex justify-content-between">
                                  <p class="fw-bold mb-1" style="color: #636363 !important">
                                    {{ "order_details.priority" | translate }}:
                                  </p>
                                  <p class="mb-1 text-primary">
                                    <i class="bi bi-lightning-charge"></i>
                                    {{
                                    "order_details.high_priority" | translate
                                    }}
                                  </p>
                                </div>
                                <div class="d-flex justify-content-between">
                                  <p class="fw-bold mb-1" style="color: #636363 !important">
                                    {{
                                    "order_details.technician_visit"
                                    | translate
                                    }}:
                                  </p>

                                  <p class="mb-1" style="
                                      color: #0e0e0e !important;
                                      font-weight: 500 !important;
                                    ">
                                    <ng-container *ngIf="
                                        getCombinedDateTime(item) !==
                                          'Not Mentioned';
                                        else notMentioned
                                      ">
                                      {{
                                      getCombinedDateTime(item)
                                      | date : "EEE, MMM d 'at' h:mm a"
                                      }}
                                    </ng-container>
                                    <ng-template #notMentioned>{{
                                      "order_details.not_mentioned" | translate
                                      }}</ng-template>
                                  </p>
                                </div>
                                <div class="d-flex justify-content-between">
                                  <p class="fw-bold mb-1" style="color: #636363 !important">
                                    {{
                                    "order_details.estimated_service_time"
                                    | translate
                                    }}:
                                  </p>
                                  <p class="mb-1" style="
                                      color: #0e0e0e !important;
                                      font-weight: 500 !important;
                                    ">
                                    {{
                                    item.ESTIMATED_TIME_IN_MIN
                                    ? item.ESTIMATED_TIME_IN_MIN +
                                    " " +
                                    ("order_details.minutes" | translate)
                                    : ("order_details.not_mentioned"
                                    | translate)
                                    }}
                                  </p>
                                </div>

                                <div *ngIf="
                                    item.GUARANTEE_ALLOWED == 1 &&
                                    customertype === 'I'
                                  " class="d-flex justify-content-between">
                                  <p class="fw-bold mb-1" style="color: #636363 !important">
                                    Guarantee Period
                                  </p>
                                  <p class="mb-1" style="
                                      color: #0e0e0e !important;
                                      font-weight: 500 !important;
                                    ">
                                    {{
                                    formatPeriodCommon(item.GUARANTEE_PERIOD)
                                    }}
                                  </p>
                                </div>

                                <div *ngIf="
                                    item.WARRANTY_ALLOWED == 1 &&
                                    customertype === 'I'
                                  " class="d-flex justify-content-between">
                                  <p class="fw-bold mb-1" style="color: #636363 !important">
                                    Warranty Period
                                  </p>
                                  <p class="mb-1" style="
                                      color: #0e0e0e !important;
                                      font-weight: 500 !important;
                                    ">
                                    {{
                                    formatPeriodCommon(item.WARRANTY_PERIOD)
                                    }}
                                  </p>
                                </div>
                              </div>
                            </div>
                          </div>
                          <!-- Status Details -->
                          <div class="mt-2">
                            <hr style="border: 1px solid #e7e6e6; margin: 0px" />

                            <button class="btn w-100 text-start d-flex justify-content-between align-items-center"
                              (click)="handleClick(i, item)" style="
                                background: transparent;
                                border: none;
                                outline: none;
                                box-shadow: none;
                                padding-bottom: 0px !important;
                              ">
                              <!-- <span class="fw-bold" style="
                                    font-size: 16px !important;
                                    font-weight: 500 !important;
                                  ">{{ 'order_review.details' | translate }}</span> -->
                              <span class="fw-bold" style="
                                  font-size: 14px !important;
                                  font-weight: 600 !important;
                                ">
                                {{ "order_details.status" | translate }}
                              </span>

                              <i class="bi" style="color: #2a3b8f !important" [ngClass]="{
                                  'bi-chevron-down': !item.isOpen,
                                  'bi-chevron-up': item.isOpen
                                }" class="text-primary"></i>
                            </button>

                            <div *ngIf="item.isOpen" class="mt-2">
                              <hr style="color: #f0f5fc" class="my-2" />

                              <div *ngIf="selectedJobLogs" style="border: none" class="accordion-item m-2 rounded">
                                <button
                                  class="btn w-100 text-start fw-semibold d-flex justify-content-between align-items-center"
                                  style="background: #fff; border-radius: 6px" type="button"
                                  (click)="toggleAccordion2()" [class.collapsed]="!isAccordionOpen2">
                                  <span>{{ getJobStatusTitle() }}</span>
                                </button>

                                <!-- </h2> -->

                                <div class="accordion-collapse" [class.show]="isAccordionOpen2">
                                  <div class="accordion-body p-3">
                                    <!-- Show spinner if data is loading -->
                                    <div *ngIf="loadingOrderStatus" class="d-flex justify-content-center">
                                      <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                      </div>
                                    </div>

                                    <!-- Show data once loaded -->
                                    <div *ngIf="!loadingOrderStatus" class="scrollable-content">
                                      <div class="status-container">
                                        <ng-container *ngIf="
                                            selectedJobLogs?.length > 0;
                                            else noDataTemplate
                                          ">
                                          <ul class="list-unstyled position-relative">
                                            <li *ngFor="
                                                let status of selectedJobLogs;
                                                let last = last
                                              " class="status-item d-flex align-items-start">
                                              <i [class]="
                                                  status.completed
                                                    ? 'bi bi-check-circle text-success'
                                                    : 'bi bi-circle text-secondary'
                                                " class="status-icon me-2"></i>
                                              <div>
                                                <p style="
                                                    color: #2a3b8f;
                                                    font-weight: 400;
                                                  " class="mb-0 fw-semibold">
                                                  {{ status.title }},
                                                  <span class="text-muted" style="
                                                      font-size: 10px !important;
                                                    ">{{ status.date }}</span>
                                                </p>
                                              </div>
                                              <div style="
                                                  background: #2a3b8f;
                                                  font-weight: 400;
                                                " *ngIf="!last" class="status-line"></div>
                                            </li>
                                          </ul>
                                        </ng-container>

                                        <!-- No Data Template -->
                                        <ng-template #noDataTemplate>
                                          <div class="text-center p-3">
                                            <img src="assets/img/hand-drawn-no-data-concept.png" alt="No Data Available"
                                              class="img-fluid" style="max-width: 150px" />
                                            <p class="text-muted mt-2">
                                              {{
                                              "order_details.no_data_available"
                                              | translate
                                              }}
                                            </p>
                                          </div>
                                        </ng-template>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>

          <div style="
              border-radius: 16px !important;
              margin-bottom: 17px !important;
            " class="accordion-item mb-2 shadow-sm rounded">
            <h2 class="accordion-header" (click)="toggleAccordion('contactDetails')">
              <button class="accordion-button fw-bold d-flex align-items-center gap-2" style="
                  justify-content: space-between;
                  padding-bottom: 13px;
                  padding-top: 13px;
                " [class.collapsed]="!orderDetailsVisible['contactDetails']">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="17" viewBox="0 0 16 17" fill="none">
                    <path
                      d="M11.1308 16.4998C9.61051 16.4811 8.15971 15.859 7.09605 14.7722L1.73154 9.40768C-0.404648 7.28129 -0.58443 4.0058 1.3043 2.10635L2.52014 0.92966C2.81921 0.634149 3.22954 0.478383 3.64965 0.502423C4.06709 0.534464 4.45784 0.716041 4.75067 1.01511L7.43782 3.70226V3.70137C8.08223 4.30306 8.12051 5.31241 7.52327 5.96129L6.93493 6.54962C6.93493 6.54962 6.93493 6.69204 7.01059 6.80597L9.69775 9.49312C9.81168 9.59726 9.9354 9.59726 9.95409 9.56878L10.5424 8.98044C11.1913 8.3832 12.2006 8.42148 12.8023 9.06589L15.4895 11.753H15.4886C16.1099 12.3538 16.1481 13.3374 15.5741 13.9836L14.3965 15.1612H14.3974C13.5322 16.0272 12.3555 16.5096 11.1308 16.4998ZM2.32079 3.11304C0.972311 4.49 1.16191 6.82557 2.73823 8.40099L8.10274 13.7655C9.67908 15.3418 12.052 15.5314 13.3907 14.1829L14.5683 13.0347C14.5683 13.0347 14.5683 12.8923 14.4828 12.7784L11.7957 10.0912C11.7387 10.0343 11.6061 9.94882 11.5491 10.0156L10.9608 10.595L10.9599 10.5941C10.6493 10.8852 10.2354 11.0409 9.80991 11.0267C9.38445 11.0125 8.98214 10.83 8.69107 10.5185L6.00392 7.81262C5.69328 7.52158 5.50992 7.11925 5.49568 6.69379C5.48144 6.26833 5.6372 5.85444 5.92825 5.5438L6.50769 4.95546C6.50769 4.95546 6.50769 4.81305 6.43204 4.70892L3.74488 2.02085C3.67813 1.9541 3.5553 1.87844 3.48854 1.9354L2.32079 3.11304Z"
                      fill="#2A3B8F" />
                  </svg>&nbsp;
                  {{ "order_details.contact_details" | translate }}
                </span>
                <i class="bi" [ngClass]="{
                    'bi-chevron-down': !orderDetailsVisible['contactDetails'],
                    'bi-chevron-up': orderDetailsVisible['contactDetails']
                  }"></i>
              </button>
            </h2>
            <div class="accordion-collapse" [class.show]="orderDetailsVisible['contactDetails']">
              <div class="accordion-collapse" [class.show]="orderDetailsVisible['contactDetails']">
                <div class="accordion-body text-muted">
                  <div class="d-flex justify-content-between">
                    <p class="mb-1 text-muted">
                      {{ "order_details.mobile_number" | translate }}
                    </p>
                    <p class="mb-1 fw-bold" style="color: black; font-weight: 500 !important">
                      {{ orderData[0]?.MOBILE_NO }}
                    </p>
                  </div>
                  <div class="d-flex justify-content-between">
                    <p class="mb-1 text-muted">
                      {{ "order_details.name" | translate }}
                    </p>
                    <p class="mb-1 fw-bold" style="color: black; font-weight: 500 !important">
                      {{ orderData[0]?.CUSTOMER_NAME }}
                    </p>
                  </div>
                  <div class="d-flex justify-content-between">
                    <p class="mb-1 text-muted">
                      {{ "order_details.address" | translate }}
                    </p>
                    <!-- <p class="mb-1 fw-bold" style="color: black;font-weight: 500 !important;">
                      <span [attr.data-bs-toggle]="
                          orderData[0]?.ADDRESS_LINE_1?.length > 16
                            ? 'tooltip'
                            : null
                        " data-bs-placement="top" [attr.title]="
                          orderData[0]?.ADDRESS_LINE_1?.length > 16
                            ? orderData[0]?.ADDRESS_LINE_1
                            : null
                        ">
                        {{ orderData[0]?.ADDRESS_LINE_1 | slice : 0 : 16 }}
                        <span *ngIf="orderData[0]?.ADDRESS_LINE_1?.length > 16">...</span> </span>,
                      <span [attr.data-bs-toggle]="
                          orderData[0]?.ADDRESS_LINE_2?.length > 16
                            ? 'tooltip'
                            : null
                        " data-bs-placement="top" [attr.title]="
                          orderData[0]?.ADDRESS_LINE_2?.length > 16
                            ? orderData[0]?.ADDRESS_LINE_2
                            : null
                        ">
                        {{ orderData[0]?.ADDRESS_LINE_2 | slice : 0 : 16 }}
                        <span *ngIf="orderData[0]?.ADDRESS_LINE_2?.length > 16">...</span>
                      </span>
                    </p> -->
                    <!-- {{maxCharLength}} -->
                    <p class="mb-1 fw-bold" style="color: black; font-weight: 500 !important">
                      <span [attr.data-bs-toggle]="
                          orderData[0]?.ADDRESS_LINE_1?.length > maxCharLength
                            ? 'tooltip'
                            : null
                        " data-bs-placement="top" [attr.title]="
                          orderData[0]?.ADDRESS_LINE_1?.length > maxCharLength
                            ? orderData[0]?.ADDRESS_LINE_1
                            : null
                        ">
                        {{
                        orderData[0]?.ADDRESS_LINE_1
                        | slice : 0 : maxCharLength
                        }}
                        <span *ngIf="
                            orderData[0]?.ADDRESS_LINE_1?.length > maxCharLength
                          ">...</span> </span>,
                      <span [attr.data-bs-toggle]="
                          orderData[0]?.ADDRESS_LINE_2?.length > maxCharLength
                            ? 'tooltip'
                            : null
                        " data-bs-placement="top" [attr.title]="
                          orderData[0]?.ADDRESS_LINE_2?.length > maxCharLength
                            ? orderData[0]?.ADDRESS_LINE_2
                            : null
                        ">
                        {{
                        orderData[0]?.ADDRESS_LINE_2
                        | slice : 0 : maxCharLength
                        }}
                        <span *ngIf="
                            orderData[0]?.ADDRESS_LINE_2?.length > maxCharLength
                          ">...</span>
                      </span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="customertype == 'I'" style="
              border-radius: 16px !important;
              margin-bottom: 17px !important;
            " class="accordion-item mb-2 shadow-sm rounded">
            <h2 class="accordion-header" (click)="toggleAccordion('reschedulePolicy')">
              <button class="accordion-button fw-bold d-flex align-items-center gap-2" style="
                  justify-content: space-between;
                  padding-bottom: 11px;
                  padding-top: 10px;
                " [class.collapsed]="!orderDetailsVisible['reschedulePolicy']">
                <span>
                  <i class="bi bi-arrow-repeat text-warning" style="
                      color: #2a3b8f !important;
                      font-size: 18px !important;
                    "></i>&nbsp;
                  {{ "order_details.reschedule_policy" | translate }}
                </span>

                <i class="bi" [ngClass]="{
                    'bi-chevron-down': !orderDetailsVisible['reschedulePolicy'],
                    'bi-chevron-up': orderDetailsVisible['reschedulePolicy']
                  }"></i>
              </button>
            </h2>
            <div class="accordion-collapse" [class.show]="orderDetailsVisible['reschedulePolicy']">
              <div class="accordion-body text-muted">
                {{ "order_details.reschedule_policy_description" | translate }}
              </div>
            </div>
          </div>

          <div *ngIf="customertype == 'I'" style="border-radius: 16px !important"
            class="accordion-item mb-2 shadow-sm rounded">
            <h2 class="accordion-header" (click)="toggleAccordion('cancelPolicy')">
              <button class="accordion-button fw-bold d-flex align-items-center gap-2" style="
                  justify-content: space-between;
                  padding-bottom: 13px;
                  padding-top: 13px;
                " [class.collapsed]="!orderDetailsVisible['cancelPolicy']">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="15" height="17" viewBox="0 0 15 17" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M6.04539 12.6157C5.82809 12.8338 5.47385 12.8338 5.25655 12.6157C5.03851 12.3984 5.03851 12.0442 5.25655 11.8269L9.72167 7.36178C9.93897 7.14373 10.2932 7.14373 10.5105 7.36178C10.7286 7.57908 10.7286 7.93331 10.5105 8.15061L6.04539 12.6157Z"
                      fill="#2A3B8F" stroke="#2A3B8F" stroke-width="0.2" />
                    <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M10.5105 11.8269C10.7286 12.0442 10.7286 12.3984 10.5105 12.6157C10.2932 12.8338 9.93897 12.8338 9.72167 12.6157L5.25655 8.15061C5.03851 7.93331 5.03851 7.57908 5.25655 7.36178C5.47385 7.14373 5.82809 7.14373 6.04539 7.36178L10.5105 11.8269Z"
                      fill="#2A3B8F" stroke="#2A3B8F" stroke-width="0.2" />
                    <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M14.7674 5.43916V14.4535C14.7674 14.996 14.5516 15.5169 14.1684 15.9009C13.7844 16.2842 13.2634 16.5 12.7209 16.5H3.04651C2.504 16.5 1.98307 16.2842 1.59907 15.9009C1.21581 15.5169 1 14.996 1 14.4535V2.54651C1 2.004 1.21581 1.48307 1.59907 1.09907C1.98307 0.715814 2.504 0.5 3.04651 0.5H10.1594C10.5263 0.5 10.8761 0.654791 11.1232 0.926419L14.4288 4.56251C14.6469 4.80288 14.7674 5.1147 14.7674 5.43916ZM13.6512 5.43916C13.6512 5.39228 13.634 5.34763 13.6028 5.3134L10.2971 1.6773C10.2614 1.6386 10.2115 1.61628 10.1594 1.61628H3.04651C2.79944 1.61628 2.56353 1.71451 2.38865 1.88865C2.21451 2.06353 2.11628 2.29944 2.11628 2.54651V14.4535C2.11628 14.7006 2.21451 14.9365 2.38865 15.1113C2.56353 15.2855 2.79944 15.3837 3.04651 15.3837H12.7209C12.968 15.3837 13.2039 15.2855 13.3788 15.1113C13.5529 14.9365 13.6512 14.7006 13.6512 14.4535V5.43916Z"
                      fill="#2A3B8F" stroke="#2A3B8F" stroke-width="0.2" />
                    <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M9.93042 1.43021C9.93042 1.12212 10.1805 0.87207 10.4886 0.87207C10.7967 0.87207 11.0467 1.12212 11.0467 1.43021V4.40695C11.0467 4.50965 11.13 4.593 11.2327 4.593H13.8374C14.1455 4.593 14.3955 4.84305 14.3955 5.15114C14.3955 5.45923 14.1455 5.70928 13.8374 5.70928H11.2327C10.5131 5.70928 9.93042 5.12584 9.93042 4.40695V1.43021Z"
                      fill="#2A3B8F" stroke="#2A3B8F" stroke-width="0.2" />
                  </svg>&nbsp;
                  {{ "order_details.cancellation_policy" | translate }}
                </span>
                <i class="bi" [ngClass]="{
                    'bi-chevron-down': !orderDetailsVisible['cancelPolicy'],
                    'bi-chevron-up': orderDetailsVisible['cancelPolicy']
                  }"></i>
              </button>
            </h2>
            <div class="accordion-collapse" [class.show]="orderDetailsVisible['cancelPolicy']">
              <div class="accordion-body text-muted">
                {{
                "order_details.cancellation_policy_description" | translate
                }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Section -->
      <div class="col-md-6">
        <div class="accordion">
          <div class="technician-card shadow-sm rounded p-2" style="
              overflow-y: auto;
              border: none;
              box-shadow: none !important;
              padding: 0px !important;
            ">
            <!-- Order Rejected -->
            <div *ngIf="orderData?.[0]?.ORDER_STATUS === 'OR'" class="alert shadow-sm mt-1" style="
                border-radius: 16px;
                padding-top: 13px;
                border-color: #cbcbcb;
              ">
              <div class="d-flex align-items-center">
                <i class="bi bi-x-circle-fill text-danger me-2"></i>
                <strong class="fw-bold d-flex align-items-center ml">{{
                  "order_details.order_rejected" | translate
                  }}</strong>
              </div>
              <p class="mt-1 text-muted" style="margin-bottom: 0px">
                {{ orderData?.[0]?.REMARK || ('order_details.no_remark_provided' | translate) }}
              </p>
            </div>

            <!-- {{orderData?.[0]?.ORDER_STATUS}} -->
            <!-- Order Accepted with Remark -->
            <div *ngIf="orderData?.[0]?.ORDER_STATUS === 'OA'" class="alert shadow-sm mt-1" style="
                border-radius: 16px;
                padding-top: 13px;
                border-color: #cbcbcb;
              ">
              <div class="d-flex align-items-center">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                <strong class="fw-bold d-flex align-items-center ml">{{
                  "order_details.order_accepted" | translate
                  }}</strong>
              </div>
              <p *ngIf="orderData?.[0]?.ACCEPTANCE_REMARK" class="mt-1 text-muted" style="margin-bottom: 0px">
                {{ orderData?.[0]?.ACCEPTANCE_REMARK }}
              </p>
            </div>

            <!-- {{orderData?.[0]?.ORDER_STATUS}} -->

            <!-- Order Canceled with Remark -->
            <div *ngIf=" orderData?.[0]?.ORDER_STATUS !== 'OA' &&  orderData?.[0]?.CANCELLATION_REMARK"
              class="alert alert-warning mt-1">
              <div class="d-flex align-items-center">
                <i class="bi bi-exclamation-circle-fill text-warning me-2"></i>
                <strong>{{
                  "order_details.cancellation_rejected" | translate
                  }}</strong>
              </div>
              <p class="mt-1 text-muted">
                {{ orderData?.[0]?.CANCELLATION_REMARK || ('order_details.cancellation_rejected_without_remark' |
                translate) }}
              </p>
            </div>

            <div *ngIf="orderData?.[0]?.ORDER_STATUS == 'CA'" class="alert alert-success mt-1">
              <div class="d-flex align-items-center">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                <strong> Cancellation Request Accepted </strong>
              </div>
            </div>

            <!-- <h5 class="fw-bold d-flex align-items-center justify-content-between">
              <Span><i class="bi bi-person-badge text-primary me-2"></i> {{ 'order_details.number_of_jobs' | translate
                }}:</Span>
              {{ orderGetDetails.length }}
            </h5> -->

            <div *ngIf="loadjobdetails" class="text-center">
              <div class="spinner-border text-primary" role="status">
                <span class="sr-only"></span>
              </div>
            </div>

            <div *ngIf="
                !loadjobdetails &&
                selectedJob?.JOB_CARD_ID &&
                selectedJob?.JOB_CARD_ID !== 0 &&
                (jobItem?.JOB_STATUS === 'AS' || jobItem?.JOB_STATUS === 'CO')
              " class="accordion-item m-2 shadow-sm rounded"
              style="margin: 0px !important; border-radius: 16px !important">
              <button class="btn w-100 text-start fw-semibold d-flex justify-content-between align-items-center"
                type="button" style="
                  background: #fff;
                  border-radius: 16px;
                  box-shadow: none !important;
                  padding-top: 11px;
                  width: 50% !important;
                " (click)="toggleAccordion3()" [class.collapsed]="!isAccordionOpen3">
                <span style="font-size: 15px !important; font-weight: 700"><svg xmlns="http://www.w3.org/2000/svg"
                    width="23" height="26" viewBox="0 0 23 26" fill="none">
                    <g clip-path="url(#clip0_5044_2680)">
                      <mask id="path-2-outside-1_5044_2680" maskUnits="userSpaceOnUse" x="2" y="3" width="19"
                        height="20" fill="black">
                        <rect fill="white" x="2" y="3" width="19" height="20" />
                        <path
                          d="M15.5948 12.9756C15.0092 12.9756 14.4518 13.0927 13.9404 13.301C13.2147 12.7636 12.4075 12.3796 11.5455 12.1669C12.6729 11.6117 13.478 10.514 13.621 9.19895C14.0843 9.19228 14.4601 8.81426 14.4601 8.3495C14.4601 7.89735 14.1043 7.5297 13.6588 7.50376C13.432 6.03021 12.3446 4.80128 10.9074 4.3973L10.9037 4.28611C10.8978 4.12675 10.7673 4 10.6072 4H9.1277C8.9676 4 8.83715 4.12601 8.83121 4.28611L8.8275 4.3973C7.39027 4.80126 6.30358 6.02949 6.07607 7.50376C5.62984 7.52971 5.27405 7.89735 5.27405 8.3495C5.27405 8.81498 5.64986 9.19301 6.11387 9.19895C6.25692 10.5154 7.06338 11.6145 8.193 12.169C5.21481 12.9087 3 15.6039 3 18.8073V20.3921C3 20.5559 3.13268 20.6886 3.29649 20.6886H12.6908C13.2141 21.1489 13.8464 21.4861 14.5446 21.6574C14.5469 21.6581 14.5491 21.6581 14.5506 21.6589C14.8856 21.7404 15.234 21.7893 15.5942 21.7893C15.9545 21.7893 16.3028 21.7411 16.6379 21.6589C16.6394 21.6581 16.6416 21.6581 16.6431 21.6574C18.5666 21.1845 20 19.45 20 17.3828C20 14.953 18.0231 12.9761 15.5933 12.9761L15.5948 12.9756ZM5.86687 8.34881C5.86687 8.2065 5.98251 8.09086 6.12483 8.09086H6.31013C6.31013 8.09086 6.3131 8.09234 6.31458 8.09234C6.32273 8.09309 6.33089 8.09309 6.33904 8.09309C6.41984 8.09309 6.49248 8.05899 6.5466 8.00562C6.5503 8.00191 6.55253 7.99673 6.55623 7.99302C6.57698 7.97004 6.59552 7.94484 6.60812 7.91593C6.61331 7.90407 6.61479 7.89073 6.61849 7.87739C6.62442 7.85812 6.63258 7.84107 6.63406 7.82031C6.73783 6.53947 7.61025 5.44023 8.80504 5.02448L8.74203 6.79378C8.7361 6.95759 8.86434 7.09471 9.02815 7.10065C9.20085 7.10658 9.32908 6.97835 9.33502 6.81454L9.41433 4.59157H10.3216L10.4009 6.81454C10.4068 6.97465 10.538 7.10065 10.6974 7.10065H10.7078C10.8716 7.09472 10.9991 6.95759 10.9939 6.79378L10.9309 5.02448C12.1257 5.43956 12.9982 6.53881 13.1018 7.82031C13.1033 7.83662 13.1107 7.84996 13.1144 7.86553C13.1189 7.88332 13.1211 7.90111 13.1293 7.91742C13.1396 7.94113 13.156 7.96115 13.1723 7.98116C13.1789 7.98932 13.1834 7.99895 13.1908 8.00636C13.2449 8.05973 13.3168 8.09309 13.3976 8.09309C13.4057 8.09309 13.4139 8.09309 13.422 8.09234C13.4235 8.09234 13.425 8.0916 13.4265 8.09086H13.6111C13.7534 8.09086 13.869 8.20649 13.869 8.34881C13.869 8.49113 13.7534 8.60677 13.6111 8.60677H6.12469C5.98237 8.60677 5.86687 8.49113 5.86687 8.34881ZM6.70817 9.19975H13.0264C12.8226 10.7726 11.4898 11.9652 9.86739 11.9652C8.24484 11.9652 6.91197 10.7733 6.70817 9.19975ZM3.59278 18.8068C3.59278 15.3624 6.39545 12.5597 9.83987 12.5597H9.8925C11.1415 12.5597 12.3236 12.92 13.343 13.6019C12.0555 14.372 11.1883 15.7759 11.1883 17.3829C11.1883 18.4066 11.5419 19.3473 12.1297 20.0958H3.59302L3.59278 18.8068ZM14.9574 21.1379V19.0121C14.9574 18.9024 14.8973 18.8024 14.801 18.7512C14.2539 18.4577 13.9144 17.8906 13.9144 17.2702C13.9144 16.7358 14.1739 16.2385 14.589 15.9286V17.2702C14.589 17.4341 14.7216 17.5667 14.8855 17.5667H16.3027C16.4665 17.5667 16.5992 17.4341 16.5992 17.2702V15.9286C17.015 16.2385 17.2737 16.7358 17.2737 17.2702C17.2737 17.8914 16.9342 18.4599 16.3864 18.7542C16.2901 18.8061 16.2308 18.9061 16.2308 19.0151V21.1381C16.0232 21.1736 15.8113 21.1959 15.5941 21.1959C15.3769 21.1959 15.1649 21.1736 14.9566 21.1381L14.9574 21.1379ZM16.8245 20.9882V19.1841C17.4723 18.766 17.8674 18.0485 17.8674 17.2702C17.8674 16.3348 17.2811 15.4838 16.4079 15.1533C16.3168 15.1185 16.2145 15.1311 16.1344 15.1867C16.0544 15.2423 16.0062 15.3334 16.0062 15.4305V16.9738H15.1819V15.4305C15.1819 15.3327 15.1345 15.2423 15.0537 15.1867C14.9736 15.1311 14.8714 15.1185 14.7802 15.1533C13.907 15.4839 13.3207 16.3341 13.3207 17.2702C13.3207 18.0485 13.7158 18.766 14.3636 19.1818V20.9882C12.8634 20.4745 11.7805 19.0544 11.7805 17.3821C11.7805 15.2792 13.4912 13.5684 15.5942 13.5684C17.697 13.5684 19.4079 15.2791 19.4079 17.3821C19.4079 19.0543 18.3249 20.4745 16.8247 20.9882L16.8245 20.9882Z" />
                      </mask>
                      <path
                        d="M15.5948 12.9756C15.0092 12.9756 14.4518 13.0927 13.9404 13.301C13.2147 12.7636 12.4075 12.3796 11.5455 12.1669C12.6729 11.6117 13.478 10.514 13.621 9.19895C14.0843 9.19228 14.4601 8.81426 14.4601 8.3495C14.4601 7.89735 14.1043 7.5297 13.6588 7.50376C13.432 6.03021 12.3446 4.80128 10.9074 4.3973L10.9037 4.28611C10.8978 4.12675 10.7673 4 10.6072 4H9.1277C8.9676 4 8.83715 4.12601 8.83121 4.28611L8.8275 4.3973C7.39027 4.80126 6.30358 6.02949 6.07607 7.50376C5.62984 7.52971 5.27405 7.89735 5.27405 8.3495C5.27405 8.81498 5.64986 9.19301 6.11387 9.19895C6.25692 10.5154 7.06338 11.6145 8.193 12.169C5.21481 12.9087 3 15.6039 3 18.8073V20.3921C3 20.5559 3.13268 20.6886 3.29649 20.6886H12.6908C13.2141 21.1489 13.8464 21.4861 14.5446 21.6574C14.5469 21.6581 14.5491 21.6581 14.5506 21.6589C14.8856 21.7404 15.234 21.7893 15.5942 21.7893C15.9545 21.7893 16.3028 21.7411 16.6379 21.6589C16.6394 21.6581 16.6416 21.6581 16.6431 21.6574C18.5666 21.1845 20 19.45 20 17.3828C20 14.953 18.0231 12.9761 15.5933 12.9761L15.5948 12.9756ZM5.86687 8.34881C5.86687 8.2065 5.98251 8.09086 6.12483 8.09086H6.31013C6.31013 8.09086 6.3131 8.09234 6.31458 8.09234C6.32273 8.09309 6.33089 8.09309 6.33904 8.09309C6.41984 8.09309 6.49248 8.05899 6.5466 8.00562C6.5503 8.00191 6.55253 7.99673 6.55623 7.99302C6.57698 7.97004 6.59552 7.94484 6.60812 7.91593C6.61331 7.90407 6.61479 7.89073 6.61849 7.87739C6.62442 7.85812 6.63258 7.84107 6.63406 7.82031C6.73783 6.53947 7.61025 5.44023 8.80504 5.02448L8.74203 6.79378C8.7361 6.95759 8.86434 7.09471 9.02815 7.10065C9.20085 7.10658 9.32908 6.97835 9.33502 6.81454L9.41433 4.59157H10.3216L10.4009 6.81454C10.4068 6.97465 10.538 7.10065 10.6974 7.10065H10.7078C10.8716 7.09472 10.9991 6.95759 10.9939 6.79378L10.9309 5.02448C12.1257 5.43956 12.9982 6.53881 13.1018 7.82031C13.1033 7.83662 13.1107 7.84996 13.1144 7.86553C13.1189 7.88332 13.1211 7.90111 13.1293 7.91742C13.1396 7.94113 13.156 7.96115 13.1723 7.98116C13.1789 7.98932 13.1834 7.99895 13.1908 8.00636C13.2449 8.05973 13.3168 8.09309 13.3976 8.09309C13.4057 8.09309 13.4139 8.09309 13.422 8.09234C13.4235 8.09234 13.425 8.0916 13.4265 8.09086H13.6111C13.7534 8.09086 13.869 8.20649 13.869 8.34881C13.869 8.49113 13.7534 8.60677 13.6111 8.60677H6.12469C5.98237 8.60677 5.86687 8.49113 5.86687 8.34881ZM6.70817 9.19975H13.0264C12.8226 10.7726 11.4898 11.9652 9.86739 11.9652C8.24484 11.9652 6.91197 10.7733 6.70817 9.19975ZM3.59278 18.8068C3.59278 15.3624 6.39545 12.5597 9.83987 12.5597H9.8925C11.1415 12.5597 12.3236 12.92 13.343 13.6019C12.0555 14.372 11.1883 15.7759 11.1883 17.3829C11.1883 18.4066 11.5419 19.3473 12.1297 20.0958H3.59302L3.59278 18.8068ZM14.9574 21.1379V19.0121C14.9574 18.9024 14.8973 18.8024 14.801 18.7512C14.2539 18.4577 13.9144 17.8906 13.9144 17.2702C13.9144 16.7358 14.1739 16.2385 14.589 15.9286V17.2702C14.589 17.4341 14.7216 17.5667 14.8855 17.5667H16.3027C16.4665 17.5667 16.5992 17.4341 16.5992 17.2702V15.9286C17.015 16.2385 17.2737 16.7358 17.2737 17.2702C17.2737 17.8914 16.9342 18.4599 16.3864 18.7542C16.2901 18.8061 16.2308 18.9061 16.2308 19.0151V21.1381C16.0232 21.1736 15.8113 21.1959 15.5941 21.1959C15.3769 21.1959 15.1649 21.1736 14.9566 21.1381L14.9574 21.1379ZM16.8245 20.9882V19.1841C17.4723 18.766 17.8674 18.0485 17.8674 17.2702C17.8674 16.3348 17.2811 15.4838 16.4079 15.1533C16.3168 15.1185 16.2145 15.1311 16.1344 15.1867C16.0544 15.2423 16.0062 15.3334 16.0062 15.4305V16.9738H15.1819V15.4305C15.1819 15.3327 15.1345 15.2423 15.0537 15.1867C14.9736 15.1311 14.8714 15.1185 14.7802 15.1533C13.907 15.4839 13.3207 16.3341 13.3207 17.2702C13.3207 18.0485 13.7158 18.766 14.3636 19.1818V20.9882C12.8634 20.4745 11.7805 19.0544 11.7805 17.3821C11.7805 15.2792 13.4912 13.5684 15.5942 13.5684C17.697 13.5684 19.4079 15.2791 19.4079 17.3821C19.4079 19.0543 18.3249 20.4745 16.8247 20.9882L16.8245 20.9882Z"
                        fill="#2A3B8F" />
                      <path
                        d="M15.5948 12.9756C15.0092 12.9756 14.4518 13.0927 13.9404 13.301C13.2147 12.7636 12.4075 12.3796 11.5455 12.1669C12.6729 11.6117 13.478 10.514 13.621 9.19895C14.0843 9.19228 14.4601 8.81426 14.4601 8.3495C14.4601 7.89735 14.1043 7.5297 13.6588 7.50376C13.432 6.03021 12.3446 4.80128 10.9074 4.3973L10.9037 4.28611C10.8978 4.12675 10.7673 4 10.6072 4H9.1277C8.9676 4 8.83715 4.12601 8.83121 4.28611L8.8275 4.3973C7.39027 4.80126 6.30358 6.02949 6.07607 7.50376C5.62984 7.52971 5.27405 7.89735 5.27405 8.3495C5.27405 8.81498 5.64986 9.19301 6.11387 9.19895C6.25692 10.5154 7.06338 11.6145 8.193 12.169C5.21481 12.9087 3 15.6039 3 18.8073V20.3921C3 20.5559 3.13268 20.6886 3.29649 20.6886H12.6908C13.2141 21.1489 13.8464 21.4861 14.5446 21.6574C14.5469 21.6581 14.5491 21.6581 14.5506 21.6589C14.8856 21.7404 15.234 21.7893 15.5942 21.7893C15.9545 21.7893 16.3028 21.7411 16.6379 21.6589C16.6394 21.6581 16.6416 21.6581 16.6431 21.6574C18.5666 21.1845 20 19.45 20 17.3828C20 14.953 18.0231 12.9761 15.5933 12.9761L15.5948 12.9756ZM5.86687 8.34881C5.86687 8.2065 5.98251 8.09086 6.12483 8.09086H6.31013C6.31013 8.09086 6.3131 8.09234 6.31458 8.09234C6.32273 8.09309 6.33089 8.09309 6.33904 8.09309C6.41984 8.09309 6.49248 8.05899 6.5466 8.00562C6.5503 8.00191 6.55253 7.99673 6.55623 7.99302C6.57698 7.97004 6.59552 7.94484 6.60812 7.91593C6.61331 7.90407 6.61479 7.89073 6.61849 7.87739C6.62442 7.85812 6.63258 7.84107 6.63406 7.82031C6.73783 6.53947 7.61025 5.44023 8.80504 5.02448L8.74203 6.79378C8.7361 6.95759 8.86434 7.09471 9.02815 7.10065C9.20085 7.10658 9.32908 6.97835 9.33502 6.81454L9.41433 4.59157H10.3216L10.4009 6.81454C10.4068 6.97465 10.538 7.10065 10.6974 7.10065H10.7078C10.8716 7.09472 10.9991 6.95759 10.9939 6.79378L10.9309 5.02448C12.1257 5.43956 12.9982 6.53881 13.1018 7.82031C13.1033 7.83662 13.1107 7.84996 13.1144 7.86553C13.1189 7.88332 13.1211 7.90111 13.1293 7.91742C13.1396 7.94113 13.156 7.96115 13.1723 7.98116C13.1789 7.98932 13.1834 7.99895 13.1908 8.00636C13.2449 8.05973 13.3168 8.09309 13.3976 8.09309C13.4057 8.09309 13.4139 8.09309 13.422 8.09234C13.4235 8.09234 13.425 8.0916 13.4265 8.09086H13.6111C13.7534 8.09086 13.869 8.20649 13.869 8.34881C13.869 8.49113 13.7534 8.60677 13.6111 8.60677H6.12469C5.98237 8.60677 5.86687 8.49113 5.86687 8.34881ZM6.70817 9.19975H13.0264C12.8226 10.7726 11.4898 11.9652 9.86739 11.9652C8.24484 11.9652 6.91197 10.7733 6.70817 9.19975ZM3.59278 18.8068C3.59278 15.3624 6.39545 12.5597 9.83987 12.5597H9.8925C11.1415 12.5597 12.3236 12.92 13.343 13.6019C12.0555 14.372 11.1883 15.7759 11.1883 17.3829C11.1883 18.4066 11.5419 19.3473 12.1297 20.0958H3.59302L3.59278 18.8068ZM14.9574 21.1379V19.0121C14.9574 18.9024 14.8973 18.8024 14.801 18.7512C14.2539 18.4577 13.9144 17.8906 13.9144 17.2702C13.9144 16.7358 14.1739 16.2385 14.589 15.9286V17.2702C14.589 17.4341 14.7216 17.5667 14.8855 17.5667H16.3027C16.4665 17.5667 16.5992 17.4341 16.5992 17.2702V15.9286C17.015 16.2385 17.2737 16.7358 17.2737 17.2702C17.2737 17.8914 16.9342 18.4599 16.3864 18.7542C16.2901 18.8061 16.2308 18.9061 16.2308 19.0151V21.1381C16.0232 21.1736 15.8113 21.1959 15.5941 21.1959C15.3769 21.1959 15.1649 21.1736 14.9566 21.1381L14.9574 21.1379ZM16.8245 20.9882V19.1841C17.4723 18.766 17.8674 18.0485 17.8674 17.2702C17.8674 16.3348 17.2811 15.4838 16.4079 15.1533C16.3168 15.1185 16.2145 15.1311 16.1344 15.1867C16.0544 15.2423 16.0062 15.3334 16.0062 15.4305V16.9738H15.1819V15.4305C15.1819 15.3327 15.1345 15.2423 15.0537 15.1867C14.9736 15.1311 14.8714 15.1185 14.7802 15.1533C13.907 15.4839 13.3207 16.3341 13.3207 17.2702C13.3207 18.0485 13.7158 18.766 14.3636 19.1818V20.9882C12.8634 20.4745 11.7805 19.0544 11.7805 17.3821C11.7805 15.2792 13.4912 13.5684 15.5942 13.5684C17.697 13.5684 19.4079 15.2791 19.4079 17.3821C19.4079 19.0543 18.3249 20.4745 16.8247 20.9882L16.8245 20.9882Z"
                        stroke="#2A3B8F" stroke-width="0.444733" mask="url(#path-2-outside-1_5044_2680)" />
                    </g>
                    <defs>
                      <clipPath id="clip0_5044_2680">
                        <rect width="23" height="26" rx="11.5" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                  {{ "order_details.technician_details" | translate }}
                </span>
                <!-- <i
                  class="bi"
                  [ngClass]="{
                    'bi-chevron-down': !isAccordionOpen3,
                    'bi-chevron-up': isAccordionOpen3
                  }"
                ></i> -->
              </button>
              <!-- </h2> -->


              <div class="accordion-collapse show">
                <div class="p-3 scrollable-content" style="
                    padding-top: 6px !important;
                    padding-bottom: 0px !important;
                  ">
                  <p class="mb-0 d-flex align-items-center">

                    <span *ngIf="selectedJob?.techData?.profile_photo">
                      <img [src]="retriveimgUrl + 'TechnicianProfile/' + selectedJob?.techData?.profile_photo"
                        alt="Attachment" style="
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    object-fit: cover;
                    margin-right:5px; 
                  " />
                    </span>

                    <span *ngIf="!selectedJob?.techData?.profile_photo">

                      <img [src]="'assets/img/blueEmpImage.png'" alt="Profile Photo" class="profile-photo" style="
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    object-fit: cover;
                    margin-right:5px; 
                  " />
                    </span>


                    <span class="fw-semibold text-dark" style="
                        font-weight: 400 !important;
                        font-size: 14px !important;
                        align-self: center;
                        align-items: center;
                        display: flex;
                      ">
                      {{ selectedJob?.techData?.name || "N/A" }} &nbsp;
                      <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13" fill="none">
                        <path
                          d="M6.19091 1.45129C6.2882 1.15187 6.7118 1.15187 6.80909 1.45129L7.88637 4.76682C7.92988 4.90073 8.05467 4.99139 8.19547 4.99139H11.6816C11.9965 4.99139 12.1274 5.39426 11.8727 5.57932L9.05229 7.62843C8.93838 7.71119 8.89072 7.85788 8.93423 7.99179L10.0115 11.3073C10.1088 11.6067 9.76609 11.8557 9.51139 11.6707L6.69103 9.62157C6.57712 9.53881 6.42288 9.53881 6.30897 9.62157L3.48861 11.6707C3.23391 11.8557 2.8912 11.6067 2.98849 11.3073L4.06577 7.99179C4.10928 7.85788 4.06161 7.71119 3.94771 7.62843L1.12735 5.57932C0.872643 5.39426 1.00354 4.99139 1.31838 4.99139H4.80453C4.94533 4.99139 5.07012 4.90073 5.11363 4.76682L6.19091 1.45129Z"
                          stroke="#FBA042" stroke-width="1.3" />
                      </svg>
                      <span class="fw-semibold" style="
                          color: #fba042 !important;
                          font-size: 12px !important;
                          font-weight: 400 !important;
                        ">
                        {{ selectedJob?.techData?.rating || "0" }} </span>&nbsp;&nbsp;
                      <svg xmlns="http://www.w3.org/2000/svg" width="15" height="14" viewBox="0 0 15 14" fill="none">
                        <path
                          d="M8.89258 0.400391C9.28826 0.400391 9.66762 0.557216 9.94727 0.836914H9.94824C10.2284 1.11657 10.3857 1.4966 10.3857 1.89258V3.65039H12.6074C13.4318 3.65054 14.0995 4.31825 14.0996 5.14258V6.53613C14.0995 6.93183 13.9419 7.31027 13.6621 7.58984L13.6631 7.59082C13.5218 7.73257 13.3536 7.8409 13.1719 7.91504V12.1074C13.1717 12.9318 12.5031 13.5995 11.6787 13.5996H3.32129C2.4969 13.5995 1.82828 12.9318 1.82812 12.1074V7.91504C1.64642 7.8409 1.47822 7.73257 1.33691 7.59082V7.58984C1.0574 7.31031 0.900501 6.9316 0.900391 6.53613V5.14258C0.900541 4.31825 1.56825 3.65054 2.39258 3.65039H4.61426V1.89258C4.61432 1.54606 4.73433 1.21172 4.95215 0.946289L5.05176 0.836914C5.33145 0.55691 5.71151 0.400391 6.10742 0.400391H8.89258ZM2.95703 12.1074C2.95718 12.3083 3.12039 12.4716 3.32129 12.4717H11.6787C11.8796 12.4716 12.0428 12.3083 12.043 12.1074V8.02832H9.45215C9.40078 8.8063 8.75486 9.42188 7.96387 9.42188H7.03613C6.24514 9.42188 5.59922 8.8063 5.54785 8.02832H2.95703V12.1074ZM7.03613 6.63574C6.83508 6.63574 6.67188 6.79894 6.67188 7V7.92871C6.67195 8.1297 6.83512 8.29297 7.03613 8.29297H7.96387C8.16488 8.29297 8.32805 8.1297 8.32812 7.92871V7C8.32812 6.79894 8.16492 6.63574 7.96387 6.63574H7.03613ZM2.39258 4.77832C2.19174 4.77847 2.02847 4.94174 2.02832 5.14258V6.53613C2.02843 6.63255 2.06677 6.72521 2.13477 6.79297H2.13574L2.19043 6.83887C2.24967 6.87848 2.32008 6.90034 2.39258 6.90039H5.54785C5.59915 6.12235 6.24509 5.50684 7.03613 5.50684H7.96387C8.75491 5.50684 9.40085 6.12235 9.45215 6.90039H12.6074C12.704 6.90032 12.7964 6.86114 12.8643 6.79297H12.8652L12.9102 6.73828C12.9498 6.67905 12.9716 6.60865 12.9717 6.53613V5.14258C12.9715 4.94174 12.8083 4.77847 12.6074 4.77832H2.39258ZM6.10742 1.52832C6.01079 1.52832 5.91748 1.56659 5.84961 1.63477V1.63574C5.78145 1.70355 5.74324 1.79601 5.74316 1.89258V3.65039H9.25684V1.89258C9.25676 1.79601 9.21855 1.70355 9.15039 1.63574V1.63477C9.08252 1.56659 8.98921 1.52832 8.89258 1.52832H6.10742Z"
                          fill="#FBA042" stroke="#FBA042" stroke-width="0.2" />
                      </svg>
                      <span class="text-muted ms-1" style="
                          color: #fba042 !important;
                          font-size: 12px !important;
                          font-weight: 400 !important;
                        ">
                        {{ selectedJob?.techData?.jobCount || "0" }} Jobs
                      </span>
                    </span>
                  </p>
                  <div *ngIf="selectedJob?.techData?.trackStatus === 'ST'" [style.height]="
                      selectedJob?.techData?.trackStatus === 'ST'
                        ? '300px'
                        : '0px'
                    " #mapContainer class="map-container"></div>
                  <div *ngIf="selectedJob?.techData?.ID" class="d-flex justify-content-between mt-3" style="
                      margin-top: 10px !important;
                      margin-bottom: 15px !important;
                    ">
                    <button *ngIf="jobItem?.JOB_STATUS === 'AS'" (click)="chatwithcustomer(selectedJob)"
                      data-bs-toggle="offcanvas" data-bs-target="#offcanvasRightttttttt"
                      aria-controls="offcanvasRightttttttt" style="
                        border: 1px solid #2a3b8f !important;
                        color: #2a3b8f !important;
                      " class="btn btn-outline-primary flex-fill me-2 btnhoverclas">
                      <i class="bi bi-chat-left" style="color: #2a3b8f !important"></i>&nbsp; {{
                      "order_details.send_message" | translate }}
                    </button>
                    <a *ngIf="jobItem?.JOB_STATUS === 'AS'" style="
                        border: 1px solid #2a3b8f !important;
                        color: #2a3b8f !important;
                      " [href]="
                        'tel:' + orderGetDetails[0]['TECHNICIAN_MOBILE_NUMBER']
                      " class="btn btn-outline-primary flex-fill btnhoverclas">
                      <i class="bi bi-telephone me-1" style="color: #2a3b8f !important"></i>&nbsp; {{
                      "order_details.call" | translate }}
                    </a>
                  </div>

                  <p *ngIf="selectedJob?.techData?.trackStatus === 'ST'" class="small text-muted mt-2">
                    {{ "order_details.replies_may_be_delayed" | translate }}
                  </p>
                </div>
              </div>
            </div>

            <!-- <label for="">{{ selectedJob?.JOB_CARD_ID}} {{loadjobdetails}} {{selectedJob?.techData?.trackStatus}} </label> -->
            <div *ngIf="
                !loadjobdetails &&
                  selectedJob?.JOB_CARD_ID &&
                  selectedJob?.JOB_CARD_ID !== 0 &&
                  selectedJob?.techData?.status !== 'P';
                else jobData
              ">
              <!-- <div class="accordion scrollable-content1"> -->
              <!-- Order Status Accordion -->

              <!-- Part Details -->
              <!-- <label for="">{{ selectedJob?.isPartAdd }}</label> -->
              <!-- <div
                *ngIf="selectedJob?.isPartAdd; else ElseCard"
                class="accordion-collapse show"
              > -->
              <div *ngIf="
                  selectedJob?.isPartAdd && customertype == 'I';
                  else ElseCard
                " class="accordion-collapse show">
                <div class="accordion-body p-3" style="padding: 15px 0px 0px !important">
                  <div class="card part-details-card1 shadow-sm rounded border bg-white p-3 mb-3"
                    style="cursor: pointer; border-radius: 16px !important"
                    (click)="openPartDetailsDrawer(selectedJob, 'PD')">
                    <div class="d-flex align-items-center mb-3">
                      <h6 class="fw-bold mb-0 text-dark">
                        {{ "order_details.part_details" | translate }}
                      </h6>
                    </div>
                    <p class="text-muted mb-0">
                      {{ "order_details.new_part_request" | translate }}
                    </p>
                  </div>
                </div>
              </div>

              <!-- {{ selectedJob?.partData?.length > 0 }} -->
              <ng-template #ElseCard>
                <div class="accordion-collapse show" *ngIf="
                    selectedJob?.partData?.length > 0 && customertype == 'I'
                  ">
                  <div class="accordion-item m-2 shadow-sm rounded" style="
                      margin: 15px 0px !important;
                      border-radius: 16px !important;
                    ">
                    <button class="btn w-100 text-start fw-semibold d-flex justify-content-between align-items-center"
                      type="button" style="
                        background: #fff;
                        border-radius: 16px;
                        padding: 11px 12px 12px;
                      " (click)="toggleAccordionPartData()" [class.collapsed]="!isAccordionOpenPartData">
                      <span style="font-size: 15px !important; font-weight: 700"><svg xmlns="http://www.w3.org/2000/svg"
                          width="20" height="20" viewBox="0 0 15 17" fill="none">
                          <path
                            d="M13.5 4.2998L7.49519 1.0498L1 4.2998M13.5 4.2998V11.7998L7.49519 15.5498M13.5 4.2998L7.49519 7.4498M7.49519 15.5498L1 11.7998V4.2998M7.49519 15.5498V7.4498M1 4.2998L7.49519 7.4498"
                            stroke="#2A3B8F" stroke-width="1.3" stroke-linejoin="round" />
                        </svg>&nbsp;

                        {{ "order_details.part_details" | translate }}
                      </span>

                      <!-- <i class="bi" [ngClass]="{
                          'bi-chevron-down': !isAccordionOpenPartData,
                          'bi-chevron-up': isAccordionOpenPartData
                        }"></i> -->
                    </button>

                    <!-- Use the same state variable -->
                    <div id="collapsePartDetails" class="accordion-collapse show">
                      <div class="offcanvas-body">
                        <div class="accordion-collapse show">
                          <div class="accordion-body p-1" style="border-top: 1px solid #dee2e6">
                            <!-- Show spinner if data is loading -->
                            <div *ngIf="loadingParts" class="d-flex justify-content-center my-3">
                              <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                              </div>
                            </div>

                            <!-- <label for="">{{loadingParts}} {{selectedJob | json}}</label> -->

                            <!-- Show data once loaded -->
                            <div *ngIf="
                                !loadingParts &&
                                selectedJob?.partData?.length > 0
                              " style="
                                max-height: 200px;
                                overflow-y: auto;
                                padding-right: 0px;
                                scrollbar-width: none;
                              ">
                              <div *ngFor="let part of selectedJob.partData"
                                class="card part-details-card1 shadow-sm rounded border bg-white p-3 mb-3" style="
                                  border-radius: 0px !important;
                                  border: none !important;
                                  box-shadow: none !important;
                                  padding: 5px 15px !important;
                                  margin-bottom: 5px !important;
                                ">
                                <div class="details-grid">
                                  <div class="d-flex justify-content-between" style="gap: 60px !important">
                                    <span class="fw-bold" style="
                                        color: #636363;
                                        font-weight: 500 !important;
                                        margin-bottom: 5px !important;
                                      ">{{
                                      "order_details.part" | translate
                                      }}</span>
                                    <span class="text-dark" style="
                                        font-weight: 500 !important;
                                        color: black !important;
                                        margin-bottom: 5px !important;
                                        text-align: right;
                                      ">{{
                                      part?.VARIANT_COMBINATION
                                      ? part?.VARIANT_COMBINATION
                                      : part.ITEM_NAME ||
                                      part.INVENTORY_NAME
                                      }}
                                    </span>
                                  </div>
                                  <div *ngIf="part.INVENTORY_CATEGORY_NAME" class="d-flex justify-content-between">
                                    <span class="fw-bold" style="
                                        color: #636363;
                                        font-weight: 500 !important;
                                        margin-bottom: 5px !important;
                                      ">{{
                                      "order_details.type" | translate
                                      }}</span>
                                    <span class="text-dark" style="
                                        font-weight: 500 !important;
                                        color: black !important;
                                        margin-bottom: 5px !important;
                                      ">{{
                                      part.INVENTORY_CATEGORY_NAME || "N/A"
                                      }}</span>
                                  </div>
                                  <div class="d-flex justify-content-between">
                                    <span class="fw-bold" style="
                                        color: #636363;
                                        font-weight: 500 !important;
                                        margin-bottom: 5px !important;
                                      ">{{
                                      "order_details.quantity" | translate
                                      }}</span>
                                    <span class="text-success" style="
                                        font-weight: 500 !important;
                                        color: black !important;
                                        margin-bottom: 5px !important;
                                      ">{{ part.QUANTITY || "N/A" }}</span>
                                  </div>
                                  <div class="d-flex justify-content-between">
                                    <span class="fw-bold" style="
                                        color: #636363;
                                        font-weight: 500 !important;
                                        margin-bottom: 5px !important;
                                      ">{{
                                      "order_details.price" | translate
                                      }}</span>
                                    <span class="text-dark" style="
                                        font-weight: 500 !important;
                                        color: black !important;
                                        margin-bottom: 5px !important;
                                      ">
                                      {{
                                      (part.TOTAL_AMOUNT | number) || "0"
                                      }}</span>
                                  </div>
                                  <div class="d-flex justify-content-between">
                                    <span class="fw-bold" style="
                                        color: #636363;
                                        font-weight: 500 !important;
                                        margin-bottom: 5px !important;
                                      ">{{
                                      "order_details.status" | translate
                                      }}</span>
                                    <span class="text-dark" style="margin-bottom: 5px !important">
                                      <!-- Accepted Status -->
                                      <span *ngIf="
                                          part.STATUS === 'AC' &&
                                          part.IS_RETURNED === 0
                                        " class="badge text-white" style="
                                          padding: 5px 8px;
                                          border-radius: 3px;
                                          border: 1px solid #adc6ff !important;
                                          color: #1d39c4 !important;
                                          background: #f0f5ff;
                                          font-size: 11px !important;
                                          border-color: #adc6ff;
                                        ">
                                        <i class="bi bi-check-circle me-2"></i>
                                        {{
                                        "order_details.accepted" | translate
                                        }}
                                      </span>
                                      <span *ngIf="part.IS_RETURNED === 1" style="
                                          padding: 5px 8px;
                                          border-radius: 3px;
                                          border: 1px solid #efa505 !important;
                                          color: #f6b809 !important;
                                          font-size: 11px !important;
                                          background: #ec740d0d;
                                        " class="badge text-white">
                                        Part Returned
                                      </span>
                                      <!-- Rejected Status -->
                                      <span *ngIf="part.STATUS === 'R'" style="
                                          padding: 5px 8px;
                                          border-radius: 3px;
                                          border: 1px solid #ff0000 !important;
                                          color: #ff0000 !important;
                                          background: #ffbfad;
                                          font-size: 11px !important;
                                          border-color: #ffbfad;
                                        " class="badge text-white">
                                        <i class="bi bi-x-circle me-2"></i>
                                        {{
                                        "order_details.rejected" | translate
                                        }}
                                      </span>
                                      <!-- N/A Status -->
                                      <span *ngIf="
                                          part.STATUS !== 'AC' &&
                                          part.STATUS !== 'R'
                                        " style="
                                          padding: 5px 8px;
                                          border-radius: 3px;
                                          border: 1px solid #ffc107 !important;
                                          color: #ffcc00 !important;
                                          font-size: 11px !important;
                                          background: #ffe7000d;
                                        " class="badge text-white">
                                        {{ "order_details.na" | translate }}
                                      </span>
                                    </span>
                                  </div>
                                </div>
                                <hr style="margin-bottom: 2px !important" />
                              </div>
                            </div>

                            <!-- Show message if no data is available -->
                            <div *ngIf="
                                !loadingParts &&
                                (!selectedJob?.partData ||
                                  selectedJob?.partData?.length === 0)
                              " class="text-center text-muted">
                              {{
                              "order_details.no_parts_available" | translate
                              }}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>

              <div *ngIf="selectedJob?.isPaymentReq" class="accordion-collapse show"
                style="border-radius: 16px !important">
                <div class="accordion-body p-3" style="
                    padding: 0px !important;
                    margin-bottom: 17px !important;
                  ">
                  <div class="card part-details-card1 shadow-sm rounded border bg-white p-3 mb-0" style="
                      cursor: pointer;
                      border-radius: 16px !important;
                      padding-bottom: 11px !important;
                    " (click)="openPartDetailsDrawer(selectedJob, 'PP')">
                    <div class="d-flex align-items-center mb-3" style="margin-bottom: 5px !important">
                      <h6 class="fw-bold mb-0 text-dark">
                        {{ "order_details.part_payment" | translate }}
                      </h6>
                    </div>
                    <p class="text-muted mb-0">
                      {{ "order_details.technician_done_job" | translate }}
                      {{ "order_details.please_make_part" | translate }}
                    </p>
                  </div>
                </div>
              </div>

              <!-- Offcanvas Drawer (Part Details) -->
              <div class="offcanvas offcanvas-end" tabindex="-1" id="partDetailsDrawer" data-bs-backdrop="static">
                <!-- Part Details Section -->
                <!-- <div *ngIf="selectedJob?.isPartAdd"> -->
                <div *ngIf="selectedJob?.isPartAdd" class="offcanvas-header border-bottom">
                  <h5 class="offcanvas-title fw-bold text-dark">
                    {{ "order_details.part_details" | translate }}
                  </h5>
                  <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
                </div>
                <!-- Add inline CSS for scrollable content -->
                <div *ngIf="selectedJob?.isPartAdd" class="offcanvas-body d-flex flex-column">
                  <div class="accordion-collapse show" style="
                      max-height: 70vh;
                      overflow-y: auto;
                      scrollbar-width: none;
                    ">
                    <div class="accordion-body p-1">
                      <div *ngIf="selectedJob?.isPartAdd && loadingParts" class="d-flex justify-content-center my-3">
                        <div class="spinner-border text-primary" role="status">
                          <span class="visually-hidden">Loading...</span>
                        </div>
                      </div>

                      <!-- Part Details -->
                      <div *ngIf="
                          selectedJob?.isPartAdd &&
                          !loadingParts &&
                          PartDetails.length
                        ">
                        <div *ngFor="let part of PartDetails"
                          class="card part-details-card1 shadow-sm rounded border bg-white p-3 mb-3" style="
                            border-radius: 16px !important;
                            padding: 11px 13px !important;
                          ">
                          <div class="details-grid">
                            <div class="d-flex justify-content-between" style="gap: 20px !important">
                              <span class="fw-bold" style="
                                  font-weight: 600 !important;
                                  margin-bottom: 10px !important;
                                ">{{ "order_details.part" | translate }}:</span>
                              <span class="text-dark" style="margin-bottom: 10px !important">{{
                                part.ITEM_NAME || part.INVENTORY_NAME
                                }}</span>
                            </div>
                            <div *ngIf="part.INVENTORY_CATEGORY_NAME" class="d-flex justify-content-between"
                              style="gap: 20px !important">
                              <span class="fw-bold" style="
                                  font-weight: 600 !important;
                                  margin-bottom: 10px !important;
                                ">{{ "order_details.type" | translate }}:</span>
                              <span class="text-dark" style="margin-bottom: 10px !important">{{
                                part.INVENTORY_CATEGORY_NAME || "N/A"
                                }}</span>
                            </div>
                            <div class="d-flex justify-content-between" style="gap: 20px !important">
                              <span class="fw-bold" style="
                                  font-weight: 600 !important;
                                  margin-bottom: 10px !important;
                                ">{{
                                "order_details.quantity" | translate
                                }}:</span>
                              <span class="text-success" style="margin-bottom: 10px !important">{{ part.QUANTITY ||
                                "N/A" }}</span>
                            </div>
                            <div class="d-flex justify-content-between" style="gap: 20px !important">
                              <span class="fw-bold" style="
                                  font-weight: 600 !important;
                                  margin-bottom: 10px !important;
                                ">{{ "order_details.price" | translate }}:</span>
                              <span class="text-dark" style="margin-bottom: 10px !important">
                                {{ (part.TOTAL_AMOUNT | number) || "0" }}</span>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- No Parts Message -->
                      <div *ngIf="!loadingParts && !PartDetails.length" class="text-center text-muted">
                        {{ "order_details.no_parts_available" | translate }}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Footer -->
                <div *ngIf="selectedJob?.isPartAdd && !loadingParts"
                  class="offcanvas-footer border-top p-3 d-flex align-items-center justify-content-end">
                  <button class="btn btn-primary w-50 me-2" (click)="acceptPartRequest('A')">
                    {{ "order_details.accept" | translate }}
                  </button>
                  <button class="btn btn-outline-danger w-50" (click)="acceptPartRequest('R')">
                    {{ "order_details.deny" | translate }}
                  </button>
                </div>

                <!-- Payment Summary Section -->
                <div *ngIf="selectedJob?.isPaymentReq" class="offcanvas-header border-bottom">
                  <h5 class="offcanvas-title fw-bold text-dark">
                    {{ "order_details.payment_summary" | translate }}
                  </h5>
                  <button type="button" class="btn-close" data-bs-dismiss="offcanvas" (click)="cancel()"></button>
                </div>
                <!-- Inline style for scrollable content -->
                <div *ngIf="selectedJob?.isPaymentReq" class="offcanvas-body d-flex flex-column"
                  style="max-height: 63vh; overflow-y: auto">
                  <div>
                    <!-- Loading Spinner -->
                    <div *ngIf="loadingParts" class="d-flex justify-content-center my-3">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>

                    <!-- Part Details -->
                    <div *ngIf="!loadingParts && PartDetails.length">
                      <div *ngFor="let part of PartDetails"
                        class="card part-details-card1 shadow-sm rounded border bg-white p-3 mb-3" style="
                          border-radius: 16px !important;
                          padding: 10px 12px !important;
                        ">
                        <div class="details-grid">
                          <div class="d-flex justify-content-between">
                            <span class="fw-bold">{{
                              "order_details.part" | translate
                              }}</span>
                            <span class="text-dark">{{
                              part.ITEM_NAME || part.INVENTORY_NAME
                              }}</span>
                          </div>
                          <div *ngIf="part.INVENTORY_CATEGORY_NAME" class="d-flex justify-content-between">
                            <span class="fw-bold">{{
                              "order_details.type" | translate
                              }}</span>
                            <span class="text-dark">{{
                              part.INVENTORY_CATEGORY_NAME || "N/A"
                              }}</span>
                          </div>
                          <div class="d-flex justify-content-between">
                            <span class="fw-bold">{{
                              "order_details.quantity" | translate
                              }}</span>
                            <span class="text-success">{{
                              part.QUANTITY || "N/A"
                              }}</span>
                          </div>
                          <div class="d-flex justify-content-between">
                            <span class="fw-bold">{{
                              "order_details.price" | translate
                              }}</span>
                            <span class="text-dark"> {{ (part.TOTAL_AMOUNT | number) || "0" }}</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- No Parts Message -->
                    <div *ngIf="!loadingParts && !PartDetails.length" class="text-center text-muted">
                      {{ "order_details.no_parts_available" | translate }}
                    </div>
                  </div>
                </div>

                <div *ngIf="selectedJob?.isPaymentReq" style="margin: 0px 16px">
                  <!-- Grand Total -->
                  <div class="card part-total-card shadow-sm rounded border bg-white p-2 mb-2" style="
                      padding: 10px 12px !important;
                      border-radius: 16px !important;
                      margin-bottom: 17px !important;
                    ">
                    <!-- <h6 class="fw-bold text-dark mb-2">{{ 'order_details.part_total' | translate }}</h6> -->
                    <!-- 
                    <div class="d-flex justify-content-between small mb-1">
                      <span class="fw-semibold">{{ 'order_details.sub_total' | translate }}:</span>
                      <span class="text-dark">
                         {{ selectedJob?.pendingPaymentsData?.TOTAL_RATE || "N/A" }}
                      </span>
                    </div>

                    <div class="d-flex justify-content-between small mb-1">
                      <span class="fw-semibold">{{ 'order_details.tax' | translate }}:</span>
                      <span class="text-dark">
                         {{ selectedJob?.pendingPaymentsData?.TOTAL_TAX_RATE || "N/A" }}
                      </span>
                    </div> -->

                    <div class="d-flex justify-content-between small mt-2" style="margin-top: 0px !important">
                      <span class="fw-bold text-dark">Total Amount</span>
                      <!-- <span class="fw-bold text-dark">
                         {{ selectedJob?.pendingPaymentsData?.TOTAL_AMOUNT || "N/A" }}
                      </span> -->
                      <!-- <span class="fw-bold text-dark">
                        
   {{ selectedJob?.pendingPaymentsData?.TOTAL_AMOUNT ? (selectedJob.pendingPaymentsData.TOTAL_AMOUNT | number) : '0' }}
</span> -->

                      <span class="fw-bold text-dark">
                        {{ (getTotalAmount() | number) || "0" }}
                      </span>
                    </div>
                  </div>

                  <h5 style="font-size: 14px !important; font-weight: bold">
                    {{ "order_details.select_payment_mode" | translate }}
                  </h5>

                  <!-- Payment Mode Selection -->
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="online" name="paymentMode"
                      [(ngModel)]="selectedPaymentMethod" value="ONLINE" />
                    <label style="font-size: 13px" class="form-check-label" for="online">{{
                      "order_details.online_payment" | translate }}</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="cod" name="paymentMode"
                      [(ngModel)]="selectedPaymentMethod" value="COD" />
                    <label style="font-size: 13px" class="form-check-label" for="cod">{{
                      "order_details.cash_on_delivery" | translate }}</label>
                  </div>
                </div>

                <!-- Footer -->
                <div *ngIf="!loadingParts && selectedJob?.isPaymentReq"
                  class="offcanvas-footer border-top p-3 d-flex align-items-center justify-content-end mt-auto gap-2">
                  <button class="btn btn-outline-danger flex-grow-1 mb-1" (click)="cancel()">
                    {{ "order_details.cancel" | translate }}
                  </button>
                  <button class="btn btn-dark flex-grow-1 mb-1" (click)="
                      proceedToPay(selectedJob, selectedJob.pendingPaymentsData)
                    " [disabled]="isLoading">
                    <span *ngIf="isLoadingPartPay" class="spinner-border spinner-border-sm me-2"></span>
                    <span *ngIf="
                        selectedPaymentMethod === 'COD';
                        else onlinepayblosk
                      ">Proceed</span>
                    <ng-template #onlinepayblosk>{{
                      "order_details.proceed_to_pay" | translate
                      }}</ng-template>
                  </button>
                </div>

                <!-- <br> -->
                <!-- </div> -->
              </div>

              <!-- Order Status End -->
              <!-- </div> -->
              <!-- dsd -->

              <!-- Technician Details Accordion -->
            </div>

            <div *ngIf="
                !loadjobdetails &&
                selectedJob?.JOB_CARD_ID &&
                selectedJob?.JOB_CARD_ID !== 0 &&
                jobItem?.JOB_STATUS == 'CO'
              " class="accordion-item m-2 shadow-sm rounde" style="
                background: #ffffff;
                border-radius: 16px !important;
                margin: 17px 0px !important;
                margin-bottom: 17px !important;
                box-shadow: 0px 0px 9.8px 0px rgba(0, 0, 0, 0.0784313725) !important;
                border-top: 1px solid #dee2e6;
              ">
              <div class="d-flex justify-content-between align-items-center mb-2"
                style="padding: 10px; margin-bottom: 0px !important">
                <h6 class="fw-semibold text-dark" style="
                    margin-bottom: 0px !important;
                    font-size: 15px !important;
                    font-weight: 700 !important;
                  ">
                  <i class="bi bi-star" style="margin-left: 4px; color: #2a3b8f; font-size: 17px"></i>&nbsp; Rate Us
                </h6>
                <button style="
                    color: #d48806;
                    background: #fffbe6;
                    border-color: #ffe58f;
                    font-size: 11px !important;
                  " *ngIf="!selectedJob?.feedbackData?.service_feedback"
                  class="btn btn-warning fw-semibold px-3 py-1 d-flex align-items-center gap-1 shadow-sm small-btn"
                  (click)="openFeedbackModal()">
                  <i class="bi bi-star text-light fs-6" style="
                      color: #d48806 !important;
                      font-size: 11px !important;
                    "></i>
                  Add Rating
                </button>
              </div>

              <!-- Display Ratings & Reviews -->
              <div *ngIf="selectedJob?.feedbackData?.service_feedback" style="
                  border: none !important;
                  box-shadow: none !important;
                  border-bottom-right-radius: 16px !important;
                  border-bottom-left-radius: 16px !important;
                  padding: 0px 15px !important;
                " class="p-3 rounded shadow-sm border bg-white">
                <!-- Service Rating -->
                <div class="mb-2">
                  <p class="mb-1 fw-semibold text-dark">Service Rating</p>
                  <div class="d-flex align-items-center">
                    <ng-container *ngFor="
                        let star of getStars(
                          selectedJob.feedbackData.service_feedback
                        )
                      ">
                      <i [class]="'bi ' + star" style="margin-right: 5px"></i>
                    </ng-container>
                    <!-- <span class="ms-2 text-muted small">({{ selectedJob.feedbackData.service_feedback }} /
                      5)</span> -->
                  </div>
                </div>

                <!-- Service Review -->
                <div class="mb-3">
                  <!-- <p class="mb-1 fw-semibold text-dark">
                    <i class="bi bi-chat-text text-secondary me-1"></i> Review:
                  </p> -->
                  <p class="bg-light p-2 rounded small text-dark">
                    {{
                    selectedJob.feedbackData.service_comment || "No comments"
                    }}
                  </p>
                </div>

                <!-- Technician Rating -->
                <div class="mt-3" *ngIf="selectedJob.feedbackData.technician_feedback !== null">
                  <p class="mb-1 fw-semibold text-dark">
                    <!-- <i class="bi bi-person-check text-primary me-1"></i> -->
                    Technician Rating
                  </p>
                  <div class="d-flex align-items-center">
                    <ng-container *ngFor="
                        let star of getStars(
                          selectedJob.feedbackData.technician_feedback
                        )
                      ">
                      <i [class]="'bi ' + star" style="margin-right: 5px"></i>
                    </ng-container>
                    <!-- <span class="ms-2 text-muted small">({{ selectedJob.feedbackData.technician_feedback }} /
                      5)</span> -->
                  </div>
                </div>

                <!-- Technician Review -->
                <div class="mt-3">
                  <!-- <p class="mb-1 fw-semibold text-dark">
                    <i class="bi bi-chat-text text-secondary me-1"></i>
                    Technician Review:
                  </p> -->
                  <p class="bg-light p-2 rounded small text-dark">
                    {{
                    selectedJob.feedbackData.technician_comment ||
                    "No comments"
                    }}
                  </p>
                </div>
              </div>
            </div>

            <ng-template #jobData>
              <div *ngIf="!loadjobdetails" class="text-center p-4">
                <img src="assets/img/no-data-concept.jpg" alt="No Data Available" class="img-fluid" width="150" />
                <p class="mt-2 text-muted">
                  {{ "order_details.no_job_data_available" | translate }}
                </p>
              </div>
            </ng-template>
          </div>
          <div class="accordion-item mt-2 shadow-sm rounded"
            style="border-radius: 16px !important; margin-top: 10px !important" *ngIf="customertype == 'I'">
            <h2 class="accordion-header" (click)="toggleAccordion('paymentSummary')">
              <button style="
                  background: white;
                  border: none !important;
                  font-size: 15px !important;
                  font-weight: 700 !important;
                  color: black;
                  box-shadow: none !important;
                  padding: 14px 12px;
                " class="accordion-button fw-bold d-flex align-items-center gap-2"
                [class.collapsed]="!orderDetailsVisible['paymentSummary']">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="18" viewBox="0 0 19 22" fill="none">
                  <path
                    d="M14.55 3.50027L4.04996 3.5C4.06562 3.5 7.08126 3.50009 7.09687 3.50027C9.2844 3.52541 11.05 5.30652 11.05 7.5C11.05 9.69483 9.28223 11.4768 7.09284 11.4998C7.07856 11.4999 4.06427 11.5 4.04996 11.5L11.05 18.5M4.04996 7.5H14.55"
                    stroke="#2A3B8F" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                {{ "order_details.payment_summary" | translate }}
              </button>
            </h2>
            <div class="accordion-collapse show">
              <div class="accordion-body" style="padding-top: 0px; padding-bottom: 10px !important">
                <div class="d-flex justify-content-between">
                  <p class="mb-1" style="color: #636363; font-weight: 500 !important">
                    {{ "order_details.base_price" | translate }}
                  </p>
                  <p class="mb-1" style="font-weight: 500 !important; color: black !important">
                    {{ orderData[0]?.TOTAL_TAXABLE_AMOUNT | number }}
                  </p>
                </div>
                <div class="d-flex justify-content-between">
                  <p class="mb-1" style="color: #636363; font-weight: 500 !important">
                    {{ "order_details.tax" | translate }}
                  </p>
                  <p class="mb-1" style="font-weight: 500 !important; color: black !important">
                    {{ orderData[0]?.TAX_AMOUNT | number }}
                  </p>
                </div>

                <!-- Show Discount if Coupon is Applied -->
                <ng-container *ngIf="orderData[0]?.DISCOUNT_AMOUNT">
                  <div class="d-flex justify-content-between">
                    <p class="mb-1" style="color: #636363; font-weight: 500 !important">
                      {{ "order_details.discount" | translate }}
                    </p>
                    <p class="mb-1" style="
                        font-weight: 500 !important;
                        color: black !important;
                      ">
                      {{ orderData[0]?.DISCOUNT_AMOUNT | number }}
                    </p>
                  </div>
                </ng-container>
                <ng-container *ngIf="orderData[0]?.IS_EXPRESS === 1">
                  <div class="d-flex justify-content-between">
                    <p class="mb-1" style="color: #636363; font-weight: 500 !important">
                      {{ "order_details.express_service" | translate }}
                    </p>
                    <p class="mb-1" style="
                        font-weight: 500 !important;
                        color: black !important;
                      ">
                      {{ orderData[0]?.EXPRESS_DELIVERY_CHARGES | number }}
                    </p>
                  </div>
                </ng-container>

                <hr style="margin-top: 10px" />
                <div class="d-flex justify-content-between fw-bold">
                  <p class="mb-1">{{ "order_details.total" | translate }}</p>
                  <p class="mb-1">{{ orderData[0]?.FINAL_AMOUNT | number }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <style>
      .custom-shadow {
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.15);
        border-radius: 8px;
      }
    </style>
  </div>

  <div #feedbackModal class="modal fade" id="feedbackModal" tabindex="-1" data-bs-backdrop="static"
    data-bs-keyboard="false" aria-labelledby="feedbackModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content rounded-3 shadow-sm border-0 p-2">
        <div class="modal-header border-0 pb-1">
          <h6 class="modal-title fw-semibold d-flex align-items-center">
            <i class="bi bi-record-circle-fill me-1" style="color: #334393"></i>
            Rate Us
          </h6>
          <button type="button" class="btn-close" (click)="closeFeedbackModal()"></button>
        </div>

        <div class="modal-body p-2">
          <form #feedbackForm="ngForm" (ngSubmit)="submitFeedback()">
            <p class="fw-medium text-dark mb-1" style="font-size: 13px">
              How would you rate the experience and service?
            </p>
            <div class="d-flex gap-1 justify-content-left mb-2">
              <i class="bi" [ngClass]="
                  rating >= star
                    ? 'bi-star-fill text-warning'
                    : 'bi-star text-muted'
                " *ngFor="let star of [1, 2, 3, 4, 5]" (click)="setRating(star, 'service')"
                style="font-size: 14px; cursor: pointer"></i>
            </div>

            <textarea class="form-control bg-light rounded-2 border-0 p-2" name="comment" [(ngModel)]="feedback.comment"
              placeholder="Tell us on how we can improve" rows="2" maxlength="256"
              style="font-size: 12px; width: 100%"></textarea>

            <p class="fw-medium text-dark mt-2 mb-1" style="font-size: 13px">
              How would you rate the technician assigned for this service?
            </p>
            <div class="d-flex gap-1 justify-content-left mb-2">
              <i class="bi" [ngClass]="
                  techRating >= star
                    ? 'bi-star-fill text-warning'
                    : 'bi-star text-muted'
                " *ngFor="let star of [1, 2, 3, 4, 5]" (click)="setRating(star, 'technician')"
                style="font-size: 14px; cursor: pointer"></i>
            </div>

            <textarea class="form-control bg-light rounded-2 border-0 p-2" name="comment1"
              [(ngModel)]="feedback.comment1" placeholder="Share your experience with our technician" rows="2"
              maxlength="256" style="font-size: 12px; width: 100%"></textarea>

            <div class="modal-footer border-0 pt-3" style="padding: 10px 0px">
              <button type="submit" class="btn w-100 py-2 rounded-2 fw-medium" style="
                  color: white !important;
                  background-color: #334393 !important;
                  font-size: 13px;
                " [disabled]="rating === 0 || techRating === 0">
                Submit
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="offcanvas offcanvas-end" data-bs-backdrop="static" tabindex="-1" id="offcanvasRightttttttt"
    aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
      <h5 id="offcanvasRightLabel">Chat with {{ chatwith }}</h5>
      <button type="button" (click)="closechat()" class="btn-close text-reset" data-bs-dismiss="offcanvas"
        aria-label="Close"></button>
    </div>
    <div class="offcanvas-body" style="overflow: hidden !important">
      <div class="d-flex justify-content-center" *ngIf="isSpinning || msgspin">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
      <div class="chat-container" *ngIf="!isSpinning && !msgspin">
        <!-- <div style="x">
        <span (click)="getmsgs()"></span>
      </div> -->
        <span style="display: none">{{ getmsgssssss() }}</span>
        <div class="message-box" style="height: 80vh; overflow: auto" id="scrollableDivvvvv" #scrollableDivvvvv>
          <!-- Customer's message -->
          <div *ngIf="groupeddata != undefined && groupeddata != null">
            <!-- <nz-spin [nzSpinning]="msgspin"> -->
            <div *ngFor="let msgdate of getKeys(groupeddata)">
              <div style="text-align: center; font-size: 10px; font-weight: 800">
                {{ msgdate | date : "dd/MM/yyyy" }}
              </div>

              <div *ngFor="let messageeee of groupeddata[msgdate]">
                <div class="message customer-message" *ngIf="messageeee['BY_CUSTOMER'] == false">
                  <span class="customer-name">{{
                    messageeee["TECHNICIAN_NAME"]
                    }}</span>
                  <div>
                    <div class="message-text" style="overflow-wrap: anywhere">
                      {{ messageeee["MESSAGE"] }}

                      <div *ngIf="
                          messageeee['ATTACHMENT_URL'] != null &&
                          messageeee['ATTACHMENT_URL'] != '' &&
                          messageeee['ATTACHMENT_URL'] != undefined
                        ">
                        <img *ngIf="
                            messageeee['ATTACHMENT_URL'].split('.').pop() ==
                              'png' ||
                            messageeee['ATTACHMENT_URL'].split('.').pop() ==
                              'jpeg' ||
                            messageeee['ATTACHMENT_URL'].split('.').pop() ==
                              'jpg' ||
                            messageeee['ATTACHMENT_URL'].split('.').pop() ==
                              'avif' ||
                            messageeee['ATTACHMENT_URL'].split('.').pop() ==
                              'jifi'
                          " width="100%" height="100px" [src]="
                            urllll + 'OrderChat/' + messageeee['ATTACHMENT_URL']
                          " alt="" />
                        <video width="100%" height="100px" controls *ngIf="
                            messageeee['ATTACHMENT_URL'].split('.').pop() ==
                              'mp4' ||
                            messageeee['ATTACHMENT_URL'].split('.').pop() ==
                              'mov' ||
                            messageeee['ATTACHMENT_URL'].split('.').pop() ==
                              'avi' ||
                            messageeee['ATTACHMENT_URL'].split('.').pop() ==
                              'wmv' ||
                            messageeee['ATTACHMENT_URL'].split('.').pop() ==
                              'mkv'
                          ">
                          <source [src]="
                              urllll +
                              'OrderChat/' +
                              messageeee['ATTACHMENT_URL']
                            " type="video/mp4" />
                        </video>
                      </div>
                    </div>

                    <div style="text-align: right !important; width: 100%" class="timestamp">
                      {{ messageeee["SEND_DATE"] | date : "dd/MM | hh:mm a" }}
                    </div>
                  </div>
                </div>

                <!-- Technician's message -->
                <div class="message technician-message" *ngIf="messageeee['BY_CUSTOMER'] == true">
                  <span class="technician-name">{{
                    messageeee["SENDER_USER_ID_USER"]
                    }}</span>
                  <div class="message-text" style="overflow-wrap: anywhere">
                    <div [innerHTML]="transform(messageeee['MESSAGE'])"></div>

                    <div *ngIf="
                        messageeee['ATTACHMENT_URL'] != null &&
                        messageeee['ATTACHMENT_URL'] != '' &&
                        messageeee['ATTACHMENT_URL'] != undefined
                      ">
                      <img *ngIf="
                          messageeee['ATTACHMENT_URL'].split('.').pop() ==
                            'png' ||
                          messageeee['ATTACHMENT_URL'].split('.').pop() ==
                            'jpeg' ||
                          messageeee['ATTACHMENT_URL'].split('.').pop() == 'jpg'
                        " class="onhover" [src]="
                          urllll + 'OrderChat/' + messageeee['ATTACHMENT_URL']
                        " alt="" />
                      <video width="100%" height="100px" controls *ngIf="
                          messageeee['ATTACHMENT_URL'].split('.').pop() == 'mp4'
                        ">
                        <source [src]="
                            urllll + 'OrderChat/' + messageeee['ATTACHMENT_URL']
                          " type="video/mp4" />
                        <source src="movie.ogg" type="video/ogg" />
                      </video>
                    </div>
                  </div>
                  <span class="timestamp">
                    {{
                    messageeee["SEND_DATE"] | date : "dd/MM | hh:mm a"
                    }}</span>
                </div>
              </div>
            </div>
            <!-- </nz-spin> -->
          </div>
        </div>
        <div *ngIf="showimagebox">
          <img *ngIf="
              ICON.split('.').pop() == 'png' ||
              ICON.split('.').pop() == 'jpeg' ||
              ICON.split('.').pop() == 'jpg'
            " width="200px" height="200px" [src]="urllll + 'OrderChat/' + ICON" alt="" />
          <video width="100%" height="200px" controls *ngIf="ICON.split('.').pop() == 'mp4'">
            <source [src]="urllll + 'OrderChat/' + ICON" type="video/mp4" />
          </video>
        </div>
        <!-- <nz-spin [nzSpinning]="isSpinning"> -->
        <div class="input-area">
          <button class="paper-clip" *ngIf="!progressBarImageOne">
            <span (click)="fileInput.click()" style="font-size: 20px !important"><i class="bi bi-upload"></i></span>
          </button>
          <!-- <nz-progress [nzPercent]="percentImageOne" [nzWidth]="30" nzType="circle"
              *ngIf="progressBarImageOne"></nz-progress> -->
          <input accept="image/*,video/*" #fileInput name="albumimage" type="file" (change)="onFileSelected($event)"
            style="display: none" required />
          <!-- <button nz-button nzType="default" class="paper-clip" (click)="showemoj()">
              <span style="font-size: 16px !important" nz-icon nzType="smile" nzTheme="outline"></span>
            </button> -->

          <!-- <ng-template #popoverTemplate>
              <div style="padding: 0px !important">
                <nz-progress
                  [nzPercent]="percentImageOne"
                  [nzWidth]="30"
                  nzType="circle"
                  *ngIf="progressBarImageOne"
                ></nz-progress>
                <span
                  *ngIf="!progressBarImageOne"
                  nz-icon
                  nzType="upload"
                  nzTheme="outline"
                  (click)="fileInput.click()"
                ></span>
                <input
                  accept="image/*,video/*"
                  #fileInput
                  name="albumimage"
                  type="file"
                  (change)="onFileSelected($event)"
                  style="display: none"
                  required
                />
              </div>
            </ng-template> -->
          <textarea placeholder="Type your message..." rows="1" #textArea id="messages2" [(ngModel)]="BODY_TEXT"
            name="BODY_TEXT" (keydown)="handleEnter($event)"></textarea>
          <div style="text-align: end">
            <button type="button" class="whatsapp-send-icon" style="width: 100% !important" (click)="sendmessage()">
              <i class="bi bi-send"></i>
              <!-- <span nz-icon nzType="send" nzTheme="outline"></span> -->
            </button>
          </div>
        </div>
        <!-- </nz-spin> -->
        <!-- (emojiSelect)="onEmojiSelect($event)" -->
        <!-- <emoji-mart *ngIf="showEmojiPicker" (emojiSelect)="onEmojiSelect($event)" [showPreview]="false"></emoji-mart> -->
      </div>
    </div>
  </div>

  <!--  -->

  <div *ngIf="isFAQDrawerVisible" id="offcanvasFAQ" class="offcanvas offcanvas-end widthclass" tabindex="-1"
    aria-labelledby="offcanvasFAQLabel">
    <button style="display: none" id="closefaq" #closefaq type="button" data-bs-dismiss="offcanvas" class="btn-close"
      (click)="FAQdrawerClose()" aria-label="Close"></button>

    <div class="offcanvas-body" style="padding: 0px">
      <app-order-show-tickets [drawerClose]="FAQcloseCallback" [isFAQDrawerVisible]="isFAQDrawerVisible"
        [orderid]="orderid" [jobcardid]="jobcardid" [orderdata]="orderdetailsnew" [type]="type">
      </app-order-show-tickets>
    </div>
  </div>
</div>