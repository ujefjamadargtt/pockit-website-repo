<!-- <ng-template #showlogin let-modal> -->
<!-- <div *ngIf="modalVisible"> -->
<div class="auth-card-container" *ngIf="modalVisible">
  <div class="auth-wrapper">
    <div
      class="auth-card"
      style="
        padding: 50px 30px 20px 30px;
        margin-bottom: 17px !important;
        margin-top: 20px;
      "
    >
      <div class="logo-container" style="margin-bottom: 0px">
        <img src="assets/img/PockITLogoF.png" alt="Logo" class="auth-logo" />
      </div>
      <div class="auth-logos">
        <img src="assets/img/welcome-logo.jpg" alt="Logo" class="auth-logo" />
        <!-- <img
          src="assets/img/pockitEngineers.png"
          alt="Logo"
          class="auth-logo"
        /> -->
      </div>
      <div class="logo-header">
        <h2 class="welcome-text">Welcome to PockIT!</h2>
        <h3 class="login-text">Login</h3>
      </div>
      <!-- <div style="color: red; margin-bottom: 15px">{{ statusCode }}</div> -->

      <form
        id="loginForm"
        class="auth-form"
        #loginSubmit="ngForm"
        (ngSubmit)="loginotpverification(loginSubmit)"
      >
        <!-- <h3>Login</h3> -->

        <div style="color: red; margin-bottom: 15px; z-index: 1">
          {{ statusCode }}
        </div>

        <div class="user-type">
          <!-- <label class="radio-label">
            <input
              type="radio"
              name="userType"
              value="home"
              [(ngModel)]="userType"
            />
            <span class="custom-radio"></span> Home User
          </label>

          <label class="radio-label">
            <input
              type="radio"
              name="userType"
              value="business"
              [(ngModel)]="userType"
            />
            <span class="custom-radio"></span> Business User
          </label> -->
        </div>
        <div class="form-group">
          <label *ngIf="mobileNumberorEmail" style="text-align: left">{{
            inputType === "initial"
              ? "Email or Mobile Number"
              : inputType === "mobile"
              ? "Mobile Number"
              : "Email"
          }}</label>

          <div class="input-field">
            <div class="unique-country-selector-wrapper">
              <div
                *ngIf="inputType === 'mobile'"
                class="unique-country-code-selector"
                style="border: 1px solid #cbcbcb; padding: 9px 6px"
                (click)="toggleCountryDropdown(); $event.stopPropagation()"
              >
                <span>{{ selectedCountryCode }}</span>
                <svg width="10" height="6" viewBox="0 0 10 6" fill="none">
                  <path d="M1 1L5 5L9 1" stroke="#666" stroke-width="1.5" />
                </svg>
                <div
                  class="unique-country-dropdown-container"
                  *ngIf="showCountryDropdown && inputType === 'mobile'"
                >
                  <div class="unique-country-dropdown">
                    <div
                      class="unique-search-box"
                      style="border-bottom: 1px solid #cbcbcb"
                    >
                      <input
                        type="text"
                        placeholder="Search country..."
                        name="countrySearch"
                        [(ngModel)]="searchQuery"
                        style="border: 1px solid #cbcbcb; padding: 10px 6px"
                        (input)="filterCountries($event)"
                        (click)="$event.stopPropagation()"
                        autocomplete="off"
                      />
                    </div>
                    <div class="unique-country-list">
                      <div
                        class="unique-country-item"
                        *ngFor="let country of filteredCountryCodes"
                        (click)="
                          selectCountry(country); $event.stopPropagation()
                        "
                      >
                        {{ country.label }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <input
                [type]="inputType === 'email' ? 'email' : 'text'"
                class="form-control"
                placeholder="{{ getPlaceholder() }}"
                [(ngModel)]="mobileNumberorEmail"
                name="identifier"
                #identifier="ngModel"
                (input)="onIdentifierInput($event)"
                [pattern]="
                  inputType === 'mobile'
                    ? commonFunction.mobpattern
                    : inputType === 'email'
                    ? emailPattern
                    : ''
                "
                [ngClass]="inputType === 'mobile' ? 'mobileClasss' : ''"
                [maxlength]="inputType === 'mobile' ? 10 : 128"
                [minlength]="inputType === 'mobile' ? 10 : null"
                (keypress)="
                  inputType === 'mobile' ? commonFunction.onlynum($event) : null
                "
                autocomplete="off"
                required
                style="
                  border: 1px solid #cbcbcb;
                  padding: 10px 6px;
                  font-size: 13px;
                  z-index: 1;
                "
              />
            </div>

            <div
              *ngIf="identifier.errors?.['required'] && (identifier.touched || loginSubmitted)"
              class="error-message"
            >
              Please enter
              {{
                inputType === "email"
                  ? "your email address"
                  : inputType === "mobile"
                  ? "your mobile number"
                  : "email or mobile number"
              }}.
            </div>

            <div
              *ngIf="identifier.errors?.['pattern'] && (identifier.touched || loginSubmitted)"
              class="error-message"
            >
              Please enter a valid
              {{ inputType === "email" ? "email address" : "mobile number" }}.
            </div>
          </div>
        </div>
        <p
          style="margin-top: 10px; position: relative"
          *ngIf="inputType !== 'initial'"
        >
          <a style="font-weight: 400; font-size: 12px !important"
            >{{
              inputType === "email"
                ? "You will receive an OTP on above email address for verification"
                : "You will receive an OTP on above WhatsApp number for verification"
            }}.</a
          >
        </p>
        <button
          type="submit"
          style="background-color: #3170de; z-index: unset"
          class="btn btn-primary btn-block"
          [disabled]="isloginSendOTP"
        >
          <span
            *ngIf="isloginSendOTP"
            class="spinner-border spinner-border-sm me-2"
            role="status"
            aria-hidden="true"
          ></span>
          {{ isloginSendOTP ? "Sending OTP..." : "Login" }}
        </button>

        <div class="auth-links">
          <p>
            Don't have an account?
            <a
              (click)="showRegisterModal()"
              style="color: #3170de; font-weight: 500"
              >Register now</a
            >
          </p>
          <p style="margin-top: 10px; position: relative">
            <a (click)="onshowMap()" style="font-weight: 500"
              >Continue as guest</a
            >
          </p>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="auth-card-container" *ngIf="openRegister">
  <div class="auth-wrapper">
    <div
      class="auth-card"
      style="
        padding: 50px 30px 20px 30px;
        margin-bottom: 17px !important;
        margin-top: 20px;
      "
    >
      <div class="logo-container" style="margin-bottom: 0px">
        <img src="assets/img/PockITLogoF.png" alt="Logo" class="auth-logo" />
      </div>
      <div class="auth-logos">
        <img src="assets/img/welcome-logo.jpg" alt="Logo" class="auth-logo" />
        <!-- <img
          src="assets/img/pockitEngineers.png"
          alt="Logo"
          class="auth-logo"
        /> -->
      </div>
      <div style="padding: 30px">
        <h2 class="welcome-text">Welcome to PockIT!</h2>
        <h3 class="login-text" style="margin-bottom: 0px">Register</h3>
      </div>
      <div
        style="
          color: red;
          margin-bottom: 15px;
          text-align: center;
          z-index: 5;
          font-size: 11px;
        "
      >
        {{ statusCode }}
      </div>
      <form
        class="register-form"
        #registrationForm="ngForm"
        (ngSubmit)="save(registrationForm)"
      >
        <!-- User Type Selection -->
        <div class="user-type">
          <!-- <label class="radio-label">
            <input
              type="radio"
              name="userType"
              value="home"
              [(ngModel)]="userType"
              (change)="onUserTypeChange()"
            />
            <span class="custom-radio"></span> Home User
          </label>

          <label class="radio-label">
            <input
              type="radio"
              name="userType"
              value="business"
              [(ngModel)]="userType"
              (change)="onUserTypeChange()"
            />
            <span class="custom-radio"></span> Business User
          </label> -->
        </div>

        <!-- Business-specific fields (Organization Name, Short Code, Contact Person) -->
        <div *ngIf="userType === 'business'" class="business-fields">
          <!-- Organization Name -->
          <div class="form-field">
            <label *ngIf="data.COMPANY_NAME" style="text-align: left">
              Organization Name*
            </label>
            <input
              type="text"
              placeholder="Enter Organization Name"
              required
              name="organizationName"
              [(ngModel)]="data.COMPANY_NAME"
              #organizationName="ngModel"
              minlength="2"
              maxlength="128"
              autocomplete="off"
              style="
                border: 1px solid #cbcbcb;
                padding: 10px 6px;
                font-size: 13px;
              "
            />
            <div
              *ngIf="organizationName.errors?.['required'] && (organizationName.touched || registrationSubmitted)"
              class="error-message"
            >
              Please enter organization name.
            </div>
          </div>

          <!-- Short Code -->
          <div class="form-field">
            <label *ngIf="data.SHORT_CODE" style="text-align: left">
              Short Code*
            </label>
            <input
              type="text"
              placeholder="Enter short code"
              required
              name="shortCode"
              [(ngModel)]="data.SHORT_CODE"
              #shortCode="ngModel"
              minlength="2"
              maxlength="8"
              pattern="^[a-zA-Z0-9]+$"
              autocomplete="off"
              style="
                border: 1px solid #cbcbcb;
                padding: 10px 6px;
                font-size: 13px;
              "
            />

            <div
              *ngIf="shortCode.errors?.['required'] && (shortCode.touched || registrationSubmitted)"
              class="error-message"
            >
              Please enter short code.
            </div>
            <div
              *ngIf="shortCode.errors?.['pattern'] && (shortCode.touched || registrationSubmitted)"
              class="error-message"
            >
              short code only contains number and letters.
            </div>
          </div>

          <!-- Contact Person Name -->
          <div class="form-field">
            <label *ngIf="data.CONTACT_PERSON_NAME" style="text-align: left">
              Contact Person Name*
            </label>
            <input
              type="text"
              placeholder="Enter Contact Person Name"
              required
              (keypress)="alphaOnly($event)"
              name="contactPersonName"
              [(ngModel)]="data.CONTACT_PERSON_NAME"
              #contactPersonName="ngModel"
              minlength="2"
              maxlength="128"
              autocomplete="off"
              style="
                border: 1px solid #cbcbcb;
                padding: 10px 6px;
                font-size: 13px;
              "
            />
            <div
              *ngIf="contactPersonName.errors?.['required'] && (contactPersonName.touched || registrationSubmitted)"
              class="error-message"
            >
              Please enter contact person name.
            </div>
          </div>
        </div>

        <!-- Name field (shown for Home User or as fallback) -->
        <div class="form-field" *ngIf="userType !== 'business'">
          <label *ngIf="data.CUSTOMER_NAME" style="text-align: left"
            >Name*</label
          >
          <input
            type="text"
            placeholder="Enter full name*"
            required
            (keypress)="alphaOnly($event)"
            name="name"
            [(ngModel)]="data.CUSTOMER_NAME"
            #name="ngModel"
            minlength="2"
            maxlength="128"
            autocomplete="off"
            style="
              border: 1px solid #cbcbcb;
              padding: 10px 6px;
              font-size: 13px;
            "
          />
          <div
            *ngIf="name.errors?.['required'] && (name.touched || registrationSubmitted)"
            class="error-message"
          >
            Please enter your name.
          </div>
        </div>

        <!-- Email Field -->
        <div class="form-field">
          <label *ngIf="data.EMAIL_ID" style="text-align: left">Email*</label>
          <input
            type="email"
            placeholder="Enter Email*"
            required
            name="emailid"
            [(ngModel)]="data.EMAIL_ID"
            #email="ngModel"
            style="
              border: 1px solid #cbcbcb;
              padding: 10px 6px;
              font-size: 13px;
            "
            [pattern]="emailPattern"
            autocomplete="off"
            maxlength="128"
          />

          <div
            *ngIf="email.errors?.['required'] && (email.touched || registrationSubmitted)"
            class="error-message"
          >
            Please enter your email address.
          </div>

          <div
            *ngIf="email.errors?.['pattern'] && (email.touched || registrationSubmitted)"
            class="error-message"
          >
            Please enter a valid email address.
          </div>
        </div>

        <!-- Mobile Number Field -->
        <div class="form-field" style="margin-bottom: 0px !important">
          <label *ngIf="data.CUSTOMER_MOBILE_NO" style="text-align: left">
            Mobile Number*
          </label>
          <div class="phone-input-group">
            <div
              class="country-code-selector"
              style="
                border: 1px solid #cbcbcb;
                padding: 10px 6px;
                font-size: 13px;
              "
              (click)="toggleCountryDropdown(); $event.stopPropagation()"
            >
              <span>{{ selectedCountryCode }}</span>
              <svg width="10" height="6" viewBox="0 0 10 6" fill="none">
                <path d="M1 1L5 5L9 1" stroke="#666" stroke-width="1.5" />
              </svg>
            </div>

            <div class="country-dropdown-container" *ngIf="showCountryDropdown">
              <div class="country-dropdown">
                <div class="search-box">
                  <input
                    type="text"
                    style="
                      border: 1px solid #cbcbcb;
                      padding: 10px 6px;
                      font-size: 13px;
                      border-radius: 5px !important;
                    "
                    placeholder="Search country..."
                    [(ngModel)]="searchQuery"
                    name="countrySearch"
                    (input)="filterCountries($event)"
                    (click)="$event.stopPropagation()"
                    autocomplete="off"
                  />
                </div>
                <div class="dropdown-container">
                  <div
                    class="unique-country-list"
                    style="height: 30vh !important; overflow: auto"
                  >
                    <div
                      class="unique-country-item"
                      style="
                        font-size: 13px;
                        text-align: left;
                        padding-left: 2px;
                      "
                      *ngFor="let country of filteredCountryCodes"
                      (click)="selectCountry(country); $event.stopPropagation()"
                    >
                      {{ country.label }}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <input
              type="text"
              placeholder="Eg. 99999 99999*"
              required
              name="phonenumber"
              [(ngModel)]="data.CUSTOMER_MOBILE_NO"
              #phone="ngModel"
              (keypress)="commonFunction.onlynum($event)"
              maxlength="10"
              minlength="10"
              style="
                border: 1px solid #cbcbcb;
                padding: 10px 6px;
                font-size: 13px;
              "
              [pattern]="commonFunction.mobpattern"
              autocomplete="off"
            />
          </div>
          <div
            *ngIf="phone.errors?.['required'] && (phone.touched || registrationSubmitted)"
            class="error-message"
          >
            Please enter your mobile number.
          </div>

          <div
            *ngIf="phone.errors?.['pattern'] && (phone.touched || registrationSubmitted)"
            class="error-message"
          >
            Please enter a valid mobile number.
          </div>
        </div>

        <p
          style="
            margin-top: 0px !important;
            position: relative;
            text-align: left;
            margin-bottom: 6px;
          "
        >
          <a style="font-weight: 400; font-size: 12px !important">
            Note: Please enter a WhatsApp-registered number.
          </a>
        </p>

        <!-- Business-specific tax fields (PAN & GST) -->
        <div *ngIf="userType === 'business'" class="business-tax-fields">
          <div style="display: flex; gap: 15px">
            <!-- PAN Number (Required for Business) -->
            <div class="form-field" style="flex: 1">
              <label *ngIf="data.PAN_NUMBER || true" style="text-align: left">
                PAN Number*
              </label>
              <input
                type="text"
                placeholder="Enter PAN Number"
                required
                name="panNumber"
                [(ngModel)]="data.PAN_NUMBER"
                #panNumber="ngModel"
                minlength="10"
                maxlength="10"
                autocomplete="off"
                style="
                  border: 1px solid #cbcbcb;
                  padding: 10px 6px;
                  font-size: 13px;
                "
                pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}"
                (input)="onPanInput($event)"
              />
              <div
                *ngIf="panNumber.errors?.['required'] && (panNumber.touched || registrationSubmitted)"
                class="error-message"
              >
                Please enter PAN number.
              </div>
              <div
                *ngIf="panNumber.errors?.['pattern'] && (panNumber.touched || registrationSubmitted)"
                class="error-message"
              >
                Please enter a valid PAN number (e.g., ABCDE1234F).
              </div>
            </div>

            <!-- GST Number (Optional for Business) -->
            <div class="form-field" style="flex: 1">
              <label *ngIf="data.GST_NUMBER || true" style="text-align: left">
                GST Number
              </label>
              <input
                type="text"
                placeholder="Enter GST Number"
                name="gstNumber"
                [(ngModel)]="data.GST_NUMBER"
                #gstNumber="ngModel"
                minlength="15"
                maxlength="15"
                autocomplete="off"
                style="
                  border: 1px solid #cbcbcb;
                  padding: 10px 6px;
                  font-size: 13px;
                "
                pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}"
                (input)="onGstInput($event)"
              />
              <div
                *ngIf="gstNumber.errors?.['pattern'] && (gstNumber.touched || registrationSubmitted)"
                class="error-message"
              >
                Please enter a valid GST number.
              </div>
            </div>
          </div>
        </div>

        <!-- Terms and Conditions Agreement -->
        <div
          class="form-field"
          style="display: flex; align-items: flex-start; text-align: left"
        >
          <!-- Checkbox -->
          <input
            type="checkbox"
            id="agree"
            name="agree"
            #agree="ngModel"
            [(ngModel)]="agreeConsent"
            required
            style="margin-top: 5px; margin-right: 8px; width: auto"
          />

          <!-- Label and error container -->
          <div>
            <label
              for="agree"
              style="font-size: 12px !important; margin-bottom: 0"
            >
              I have read and agree to the
              <a
                (click)="openTerms()"
                style="
                  color: #3170de;
                  cursor: pointer;
                  text-decoration: underline;
                "
              >
                Terms and Conditions
              </a>
              and
              <a
                (click)="openPPolicy()"
                style="
                  color: #3170de;
                  cursor: pointer;
                  text-decoration: underline;
                "
              >
                Privacy Policy
              </a>
              of PockIT Engineers
            </label>

            <div
              class="error-message"
              *ngIf="!agreeConsent && registrationSubmitted"
              style="font-size: 12px; color: red; margin-top: 4px"
            >
              You must agree to the Terms and Conditions before submitting.
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="register-button">
          <span
            *ngIf="issignUpLoading"
            class="spinner-border spinner-border-sm me-2"
          ></span>
          {{ issignUpLoading ? "Sending OTP..." : "Register" }}
        </button>

        <!-- Login Link -->
        <p class="login-link" style="margin-bottom: 0rem">
          Already have an account? <a (click)="openLoginModal()">Login</a>
        </p>
      </form>
    </div>
  </div>
</div>

<div class="auth-card-container" *ngIf="openVerify && !isverifyOTP">
  <div class="auth-wrapper">
    <div
      class="auth-card"
      style="
        padding: 50px 30px 20px 30px;
        margin-bottom: 17px !important;
        margin-top: 20px;
      "
    >
      <div class="logo-container" style="margin-bottom: 0px">
        <img src="assets/img/PockITLogoF.png" alt="Logo" class="auth-logo" />
      </div>
      <div class="auth-logos">
        <img src="assets/img/welcome-logo.jpg" alt="Logo" class="auth-logo" />
        <!-- <img
          src="assets/img/pockitEngineers.png"
          alt="Logo"
          class="auth-logo"
        /> -->
      </div>

      <div class="otp-content" style="margin-top: 50px">
        <h2 style="font-size: 20px">Enter Verification Code</h2>
        <p class="verification-text" style="color: #cbcbcb; font-size: 13px">
          We've sent a 4-digit verification code to<br />
          <span class="phone-number" style="color: #636363; font-size: 14px">
            <span *ngIf="inputType === 'mobile'"
              >{{ selectedCountryCode }} &nbsp;</span
            >
            {{ mobileNumberorEmail }}
          </span>
          &nbsp;<span (click)="openLoginModal()"
            ><i class="bi bi-pencil-square"></i
          ></span>
        </p>

        <div style="color: red; margin-bottom: 15px; z-index: 5">
          {{ statusCode }}
        </div>

        <form (ngSubmit)="VerifyOTP()" class="otp-form">
          <div class="otp-input-group">
            <input
              *ngFor="let i of [0, 1, 2, 3]"
              class="otp-input"
              type="text"
              [(ngModel)]="otp[i]"
              [name]="'otp-' + i"
              maxlength="1"
              (keydown)="moveToNext($event, i)"
              (keypress)="allowOnlyNumbers($event)"
              (ngModelChange)="onChange($event, i)"
              (paste)="handlePaste($event)"
              required
              autocomplete="off"
            />
          </div>

          <div class="timer-section">
            <span *ngIf="remainingTime > 0">{{ remainingTime }}</span>
            <p class="resend-text" style="color: #636363">
              Didn't receive the code?
              <a
                (click)="remainingTime == 0 ? resendOtp() : ''"
                [ngStyle]="{
                  cursor: remainingTime > 0 ? 'wait' : 'pointer',
                  color:
                    remainingTime > 0
                      ? '#636363 !important'
                      : '#3170de !important'
                }"
                [class.disabled]="remainingTime > 0"
                [ngClass]="{ 'finished-time': remainingTime <= 0 }"
              >
                <span> Resend </span>
              </a>
            </p>
          </div>

          <button type="submit" class="verify-button" [disabled]="isverifyOTP">
            <span
              *ngIf="isverifyOTP"
              class="spinner-border spinner-border-sm me-2"
            ></span>
            Verify
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="user-location-container" *ngIf="showMap">
  <div class="user-location-wrapper">
    <div class="user-location-header">
      <p class="location-title">User Location</p>
      <p class="location-subtitle">Place the marker at your order location</p>
    </div>

    <div class="user-location-map" id="map"></div>

    <div class="user-location-details">
      <!-- <h3 class="location-code">{{ locationCode || "Loading..." }}</h3> -->
      <p class="location-address">
        {{ locationAddress || "Fetching address..." }}
      </p>
    </div>

    <div class="user-location-footer">
      <button
        [disabled]="!locationAddress"
        class="location-confirm-btn"
        (click)="confirmLocation()"
      >
        Confirm Location
      </button>
      <div
        style="
          text-align: center;
          color: rgb(95, 93, 93);
          margin-top: 10px;
          cursor: pointer;
        "
        (click)="backtologin()"
      >
        Back to login
      </div>
    </div>
  </div>
</div>

<ng-template #openMap let-modal class="map-container">
  <div class="map-header">
    <p class="mb-0">User Location</p>
    <p class="text-muted small mb-0">Place the marker at your order location</p>
  </div>
  <div id="map"></div>
  <div class="location-details">
    <!-- <h3>{{ locationCode || "Loading..." }}</h3> -->
    <p>{{ locationAddress || "Fetching address..." }}</p>
  </div>
  <div class="map-footer">
    <button class="btn btn-primary" (click)="confirmLocation()">Confirm</button>
  </div>
</ng-template>

<div *ngIf="showAddressDetailsForm" class="address-form-container">
  <div class="card shadow-sm address-form-card" style="border: none">
    <div
      class="d-flex justify-content-center align-items-center card-header"
      style="height: 80px; border-bottom: none"
    >
      <div class="icon-wrapper">
        <svg
          width="66"
          height="67"
          viewBox="0 0 66 67"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <circle
            cx="33"
            cy="33.5"
            r="32.7988"
            stroke="#FFDFBE"
            stroke-width="0.402439"
          />
          <circle
            cx="33.0004"
            cy="33.5"
            r="26.3598"
            stroke="#FFDFBE"
            stroke-width="0.402439"
          />
          <path
            d="M20.6299 39.7112C16.1906 33.6198 16.8468 25.2031 22.1766 19.8733C28.154 13.8959 37.8454 13.8959 43.8228 19.8733C49.1526 25.2031 49.8088 33.6198 45.3695 39.7112L36.0195 52.541C34.5271 54.5888 31.4723 54.5888 29.9799 52.541L20.6299 39.7112Z"
            fill="#2A3B8F"
          />
          <circle cx="33.0137" cy="31.5595" r="5.97857" fill="#FDEEE9" />
        </svg>
      </div>
    </div>

    <form
      #addressSubmit="ngForm"
      (ngSubmit)="saveAddress(addressSubmit)"
      class="p-3"
    >
      <div style="background-color: #f4f7f9; padding: 15px">
        <h2
          class="form-title mb-0 ms-3"
          style="
            padding: 0px 0px 15px;
            margin-left: 0px !important;
            font-size: 17px;
          "
        >
          Enter address details
        </h2>
        <div
          class="mb-3"
          style="border-radius: 8px; padding: 12px; background: #fdfdfd"
        >
          <label class="form-label text-muted small" style="display: flex"
            >Save address as *</label
          >
          <div class="btn-group custom-btn-group">
            <button
              type="button"
              class="btn"
              [ngClass]="{
                'btn-outline-primary': addressForm.TYPE !== 'H',
                'btn-primary': addressForm.TYPE === 'H'
              }"
              (click)="addressForm.TYPE = 'H'"
            >
              Home
            </button>
            <button
              type="button"
              class="btn"
              [ngClass]="{
                'btn-outline-primary': addressForm.TYPE !== 'F',
                'btn-primary': addressForm.TYPE === 'F'
              }"
              (click)="addressForm.TYPE = 'F'"
            >
              Work
            </button>
            <button
              style="margin-left: 10px"
              type="button"
              class="btn"
              [ngClass]="{
                'btn-outline-primary': addressForm.TYPE !== 'O',
                'btn-primary': addressForm.TYPE === 'O'
              }"
              (click)="addressForm.TYPE = 'O'"
            >
              Other
            </button>
          </div>
        </div>

        <div class="mb-3 contact-details" *ngIf="!asGuest">
          <label class="form-label" style="font-size: 13px"
            >Contact Person Details</label
          >
          <div style="font-size: 13px">
            {{ data.CUSTOMER_NAME }} <b>{{ data.CUSTOMER_MOBILE_NO }}</b>
          </div>
        </div>
        <div style="border-radius: 8px; padding: 12px; background: #fdfdfd">
          <div class="form-group position-relative" style="padding: 10px">
            <!-- <input
              type="text"
              class="form-control"
              [value]="locationCode || 'WJHV+GV5'"
              readonly
              autocomplete="off"
            /> -->
            <button
              type="button"
              style="font-size: 13px"
              class="btn btn-link position-absolute end-0 top-50 translate-middle-y"
              (click)="onshowMap()"
            >
              Change Location
            </button>
          </div>

          <div class="row mt-2">
            <!-- Address Line 1 -->
            <div class="col-md-6">
              <input
                type="text"
                class="form-control"
                placeholder="House number/flat no/floor no"
                [(ngModel)]="addressForm.ADDRESS_LINE_1"
                name="addressLine1"
                required
                #addressLine1="ngModel"
                autocomplete="off"
                maxlength="256"
              />
              <div
                *ngIf="(addressLine1.errors?.['required'] && (addressLine1.touched || addressSubmitted))"
                class="error-message"
              >
                Please enter house number/flat no/floor no.
              </div>
            </div>

            <!-- Address Line 2 -->
            <div class="col-md-6">
              <input
                type="text"
                class="form-control"
                placeholder="Area/street/village"
                [(ngModel)]="addressForm.ADDRESS_LINE_2"
                name="addressLine2"
                autocomplete="off"
                required
                #addressLine2="ngModel"
                maxlength="256"
              />
              <div
                *ngIf="(addressLine2.errors?.['required'] && (addressLine2.touched || addressSubmitted))"
                class="error-message"
              >
                Please enter Area/street/village.
              </div>
            </div>
          </div>

          <div class="row mt-2">
            <!-- Landmark -->
            <div class="col-md-6">
              <input
                type="text"
                class="form-control"
                placeholder="Landmark (optional)"
                [(ngModel)]="addressForm.LANDMARK"
                name="landmark"
                autocomplete="off"
                maxlength="128"
              />
            </div>

            <!-- Pincode Dropdown -->
            <div class="col-md-6">
              <div class="position-relative">
                <!-- (click)="togglePincodeDropdown(); $event.stopPropagation()" -->
                <div class="dropdown-wrapper">
                  <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="selectedPincode"
                    placeholder="Select pincode"
                    name="pincode"
                    #pincode="ngModel"
                    required
                    maxlength="64"
                    readonly
                    autocomplete="off"
                  />
                  <div
                    *ngIf="isLoading"
                    class="loading-container1 spinner-inside"
                  >
                    <div
                      style="text-align: center"
                      class="spinner-border"
                      role="status"
                    >
                      <span class="visually-hidden">Loading...</span>
                    </div>
                  </div>
                  <!-- <span class="dropdown-icon"></span> -->
                </div>
                <!-- <div
                  *ngIf="(pincode.errors?.['required'] && (pincode.touched || addressSubmitted))"
                  class="error-message"
                >
                  Please Select Pin Code.
                </div> -->
                <!-- <div *ngIf="showPincodeDropdown" class="dropdown-menu show">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search pincode..."
                    [(ngModel)]="searchPincode"
                    name="pincodeSearch"
                    (input)="filterPincodes($event)"
                    (click)="$event.stopPropagation()"
                    autocomplete="off"
                  />
                  <div
                    class="dropdown-item"
                    *ngFor="let pincode of filteredPincodes"
                    (click)="selectPincode(pincode)"
                  >
                    {{ pincode.PINCODE_NUMBER }}
                  </div>
                </div> -->
                <div
                  style="font-size: 12px"
                  *ngIf="
                    pincode.invalid && (pincode.touched || addressSubmitted)
                  "
                  class="text-danger mt-1"
                >
                  <div *ngIf="pincode.errors?.['required']">
                    Please select pincode.
                  </div>
                  <div *ngIf="pincode.errors?.['maxlength']">
                    Max length exceeded.
                  </div>
                  <!-- Add more conditions if needed -->
                </div>
              </div>
            </div>
          </div>

          <div class="row mt-2">
            <!-- City -->
            <div class="col-md-6">
              <input
                type="text"
                class="form-control"
                [(ngModel)]="addressForm.CITY_NAME"
                [placeholder]="'Enter City'"
                name="CITY_NAME"
                autocomplete="off"
                maxlength="128"
                required
                #CITY_NAME="ngModel"
              />
              <div
                *ngIf="(CITY_NAME.errors?.['required'] && (CITY_NAME.touched || addressSubmitted))"
                class="error-message"
              >
                Please enter City.
              </div>
            </div>

            <!-- State Dropdown -->
            <div class="col-md-6">
              <div class="position-relative">
                <div
                  class="dropdown-wrapper"
                  (click)="toggleStatesDropdown(); $event.stopPropagation()"
                >
                  <input
                    type="text"
                    class="form-control"
                    [value]="selectedState || 'Select State...'"
                    readonly
                    autocomplete="off"
                  />
                  <span class="dropdown-icon"></span>
                </div>
                <div *ngIf="showStateDropdown" class="dropdown-menu show">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search State..."
                    [(ngModel)]="searchState"
                    name="stateSearch"
                    (input)="filterStates($event)"
                    (click)="$event.stopPropagation()"
                    autocomplete="off"
                  />
                  <div
                    class="dropdown-item"
                    *ngFor="let state of filteredStates"
                    (click)="selectState(state)"
                  >
                    {{ state.NAME }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-center mt-3">
          <button
            [disabled]="isAddrssSaving"
            type="submit"
            class="btn btn-primary w-100"
          >
            <span
              *ngIf="isAddrssSaving"
              class="spinner-border spinner-border-sm me-2"
            ></span>
            Confirm
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
